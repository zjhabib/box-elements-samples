{"version":3,"sources":["../../../../src/features/classification/security-controls/utils.js"],"names":["getProp","isNil","appRestrictionsMessageMap","downloadRestrictionsMessageMap","messages","ACCESS_POLICY_RESTRICTION","DOWNLOAD_CONTROL","LIST_ACCESS_LEVEL","SHARED_LINK_ACCESS_LEVEL","SHARED_LINK","DOWNLOAD","EXTERNAL_COLLAB","APP","DESKTOP","MOBILE","WEB","BLOCK","WHITELIST","BLACKLIST","COLLAB_ONLY","COLLAB_AND_COMPANY_ONLY","PUBLIC","getShortSecurityControlsMessage","controls","sharedLink","download","externalCollab","app","sharing","accessLevel","message","shortAllRestrictions","shortSharingDownload","shortSharingApp","shortDownloadApp","shortSharing","shortDownload","shortApp","getSharedLinkMessages","items","push","sharingCollabOnly","sharingCollabAndCompanyOnly","getExternalCollabMessages","externalCollabBlock","externalCollabDomainList","getAppDownloadMessages","maxAppCount","appDownloadBlock","apps","length","appsToDisplay","slice","remainingAppCount","appNames","map","displayText","join","appsList","overflow","values","tooltipMessage","allAppNames","default","getDownloadMessages","web","mobile","desktop","downloadRestrictions","platform","restrictions","Object","keys","forEach","platformKey","restrictExternalUsers","restrictManagedUsers","externalRestricted","externalAllowed","getFullSecurityControlsMessages"],"mappings":";;;;;;;;;;;;;;AACA,OAAOA,OAAP,MAAoB,YAApB;AACA,OAAOC,KAAP,MAAkB,cAAlB;AAIA,OAAOC,yBAAP,MAAsC,6BAAtC;AACA,OAAOC,8BAAP,MAA2C,kCAA3C;AACA,OAAOC,QAAP,MAAqB,YAArB;AACA,SAASC,yBAAT,EAAoCC,gBAApC,EAAsDC,iBAAtD,EAAyEC,wBAAzE,QAAyG,cAAzG;IAEQC,W,GAAgDJ,yB,CAAhDI,W;IAAaC,Q,GAAmCL,yB,CAAnCK,Q;IAAUC,e,GAAyBN,yB,CAAzBM,e;IAAiBC,G,GAAQP,yB,CAARO,G;IACxCC,O,GAAyBP,gB,CAAzBO,O;IAASC,M,GAAgBR,gB,CAAhBQ,M;IAAQC,G,GAAQT,gB,CAARS,G;IACjBC,K,GAAgCT,iB,CAAhCS,K;IAAOC,S,GAAyBV,iB,CAAzBU,S;IAAWC,S,GAAcX,iB,CAAdW,S;IAClBC,W,GAAiDX,wB,CAAjDW,W;IAAaC,uB,GAAoCZ,wB,CAApCY,uB;IAAyBC,M,GAAWb,wB,CAAXa,M;;AAE9C,IAAMC,+BAA+B,GAAG,SAAlCA,+BAAkC,CAACC,QAAD,EAAsC;AAAA,MAClEC,UADkE,GACpBD,QADoB,CAClEC,UADkE;AAAA,MACtDC,QADsD,GACpBF,QADoB,CACtDE,QADsD;AAAA,MAC5CC,cAD4C,GACpBH,QADoB,CAC5CG,cAD4C;AAAA,MAC5BC,GAD4B,GACpBJ,QADoB,CAC5BI,GAD4B,EAE1E;AACA;;AACA,MAAMC,OAAO,GAAIJ,UAAU,IAAIA,UAAU,CAACK,WAAX,KAA2BR,MAA1C,IAAqDK,cAArE;;AAEA,MAAIE,OAAO,IAAIH,QAAX,IAAuBE,GAA3B,EAAgC;AAC5B,WAAO;AAAEG,MAAAA,OAAO,EAAE1B,QAAQ,CAAC2B;AAApB,KAAP;AACH;;AAED,MAAIH,OAAO,IAAIH,QAAf,EAAyB;AACrB,WAAO;AAAEK,MAAAA,OAAO,EAAE1B,QAAQ,CAAC4B;AAApB,KAAP;AACH;;AAED,MAAIJ,OAAO,IAAID,GAAf,EAAoB;AAChB,WAAO;AAAEG,MAAAA,OAAO,EAAE1B,QAAQ,CAAC6B;AAApB,KAAP;AACH;;AAED,MAAIR,QAAQ,IAAIE,GAAhB,EAAqB;AACjB,WAAO;AAAEG,MAAAA,OAAO,EAAE1B,QAAQ,CAAC8B;AAApB,KAAP;AACH;;AAED,MAAIN,OAAJ,EAAa;AACT,WAAO;AAAEE,MAAAA,OAAO,EAAE1B,QAAQ,CAAC+B;AAApB,KAAP;AACH;;AAED,MAAIV,QAAJ,EAAc;AACV,WAAO;AAAEK,MAAAA,OAAO,EAAE1B,QAAQ,CAACgC;AAApB,KAAP;AACH;;AAED,MAAIT,GAAJ,EAAS;AACL,WAAO;AAAEG,MAAAA,OAAO,EAAE1B,QAAQ,CAACiC;AAApB,KAAP;AACH;;AAED,SAAO,IAAP;AACH,CAnCD;;AAqCA,IAAMC,qBAAqB,GAAG,SAAxBA,qBAAwB,CAACf,QAAD,EAA4C;AACtE,MAAMgB,KAAK,GAAG,EAAd;AACA,MAAMV,WAAW,GAAG7B,OAAO,CAACuB,QAAD,YAAcd,WAAd,kBAA3B;;AAEA,UAAQoB,WAAR;AACI,SAAKV,WAAL;AACIoB,MAAAA,KAAK,CAACC,IAAN,CAAW;AAAEV,QAAAA,OAAO,EAAE1B,QAAQ,CAACqC;AAApB,OAAX;AACA;;AACJ,SAAKrB,uBAAL;AACImB,MAAAA,KAAK,CAACC,IAAN,CAAW;AAAEV,QAAAA,OAAO,EAAE1B,QAAQ,CAACsC;AAApB,OAAX;AACA;;AACJ;AACI;AACA;AATR;;AAWA,SAAOH,KAAP;AACH,CAhBD;;AAkBA,IAAMI,yBAAyB,GAAG,SAA5BA,yBAA4B,CAACpB,QAAD,EAA4C;AAC1E,MAAMgB,KAAK,GAAG,EAAd;AACA,MAAMV,WAAW,GAAG7B,OAAO,CAACuB,QAAD,YAAcZ,eAAd,kBAA3B;;AAEA,UAAQkB,WAAR;AACI,SAAKb,KAAL;AACIuB,MAAAA,KAAK,CAACC,IAAN,CAAW;AAAEV,QAAAA,OAAO,EAAE1B,QAAQ,CAACwC;AAApB,OAAX;AACA;;AACJ,SAAK3B,SAAL;AACA,SAAKC,SAAL;AACIqB,MAAAA,KAAK,CAACC,IAAN,CAAW;AAAEV,QAAAA,OAAO,EAAE1B,QAAQ,CAACyC;AAApB,OAAX;AACA;;AACJ;AACI;AACA;AAVR;;AAYA,SAAON,KAAP;AACH,CAjBD;;AAmBA,IAAMO,sBAAsB,GAAG,SAAzBA,sBAAyB,CAACvB,QAAD,EAAqBwB,WAArB,EAAkE;AAC7F,MAAMR,KAAK,GAAG,EAAd;AACA,MAAMV,WAAW,GAAG7B,OAAO,CAACuB,QAAD,YAAcX,GAAd,kBAA3B;;AAEA,UAAQiB,WAAR;AACI,SAAKb,KAAL;AACIuB,MAAAA,KAAK,CAACC,IAAN,CAAW;AAAEV,QAAAA,OAAO,EAAE1B,QAAQ,CAAC4C;AAApB,OAAX;AACA;;AACJ,SAAK/B,SAAL;AACA,SAAKC,SAAL;AAAgB;AACZ,YAAM+B,IAAI,GAAGjD,OAAO,CAACuB,QAAD,YAAcX,GAAd,YAA0B,EAA1B,CAApB;AAEAmC,QAAAA,WAAW,GAAG9C,KAAK,CAAC8C,WAAD,CAAL,GAAqBE,IAAI,CAACC,MAA1B,GAAmCH,WAAjD;AACA,YAAMI,aAAa,GAAGF,IAAI,CAACG,KAAL,CAAW,CAAX,EAAcL,WAAd,CAAtB;AACA,YAAMM,iBAAiB,GAAGJ,IAAI,CAACG,KAAL,CAAWL,WAAX,EAAwBG,MAAlD;AACA,YAAMI,QAAQ,GAAGH,aAAa,CAACI,GAAd,CAAkB;AAAA,cAAGC,WAAH,QAAGA,WAAH;AAAA,iBAAqBA,WAArB;AAAA,SAAlB,EAAoDC,IAApD,CAAyD,IAAzD,CAAjB;;AAEA,YAAIJ,iBAAJ,EAAuB;AACnB,cAAMK,QAAQ,GAAGT,IAAI,CAACM,GAAL,CAAS;AAAA,gBAAGC,WAAH,SAAGA,WAAH;AAAA,mBAAqBA,WAArB;AAAA,WAAT,EAA2CC,IAA3C,CAAgD,IAAhD,CAAjB;AAEAlB,UAAAA,KAAK,CAACC,IAAN,CAAW;AACPV,YAAAA,OAAO,oBACA5B,yBAAyB,CAAC2B,WAAD,CAAzB,CAAuC8B,QADvC;AAEHC,cAAAA,MAAM,EAAE;AAAEN,gBAAAA,QAAQ,EAARA,QAAF;AAAYD,gBAAAA,iBAAiB,EAAjBA;AAAZ;AAFL,cADA;AAKPQ,YAAAA,cAAc,oBACPzD,QAAQ,CAAC0D,WADF;AAEVF,cAAAA,MAAM,EAAE;AAAEF,gBAAAA,QAAQ,EAARA;AAAF;AAFE;AALP,WAAX;AAUH,SAbD,MAaO;AACHnB,UAAAA,KAAK,CAACC,IAAN,CAAW;AACPV,YAAAA,OAAO,oBACA5B,yBAAyB,CAAC2B,WAAD,CAAzB,CAAuCkC,OADvC;AAEHH,cAAAA,MAAM,EAAE;AAAEN,gBAAAA,QAAQ,EAARA;AAAF;AAFL;AADA,WAAX;AAMH;;AACD;AACH;;AACD;AACI;AACA;AAtCR;;AAwCA,SAAOf,KAAP;AACH,CA7CD;;AA+CA,IAAMyB,mBAAmB,GAAG,SAAtBA,mBAAsB,CAACzC,QAAD,EAA4C;AAAA;;AACpE,MAAMgB,KAAK,GAAG,EAAd;;AADoE,iBAEnCvC,OAAO,CAACuB,QAAD,EAAWb,QAAX,EAAqB,EAArB,CAF4B;AAAA,MAE5DuD,GAF4D,YAE5DA,GAF4D;AAAA,MAEvDC,MAFuD,YAEvDA,MAFuD;AAAA,MAE/CC,OAF+C,YAE/CA,OAF+C;;AAIpE,MAAMC,oBAAoB,uEACrBrD,GADqB,EACf;AACHsD,IAAAA,QAAQ,EAAEtD,GADP;AAEHuD,IAAAA,YAAY,EAAEL;AAFX,GADe,0CAKrBnD,MALqB,EAKZ;AACNuD,IAAAA,QAAQ,EAAEvD,MADJ;AAENwD,IAAAA,YAAY,EAAEJ;AAFR,GALY,0CASrBrD,OATqB,EASX;AACPwD,IAAAA,QAAQ,EAAExD,OADH;AAEPyD,IAAAA,YAAY,EAAEH;AAFP,GATW,yBAA1B;AAeAI,EAAAA,MAAM,CAACC,IAAP,CAAYJ,oBAAZ,EAAkCK,OAAlC,CAA0C,UAAAC,WAAW,EAAI;AAAA,iCAClBN,oBAAoB,CAACM,WAAD,CADF;AAAA,QAC7CL,QAD6C,0BAC7CA,QAD6C;AAAA,QACnCC,YADmC,0BACnCA,YADmC;;AAGrD,QAAI,CAACA,YAAL,EAAmB;AACf;AACH;;AALoD,QAM7CK,qBAN6C,GAMGL,YANH,CAM7CK,qBAN6C;AAAA,QAMtBC,oBANsB,GAMGN,YANH,CAMtBM,oBANsB;;AAQrD,QAAIA,oBAAoB,IAAID,qBAA5B,EAAmD;AAC/CpC,MAAAA,KAAK,CAACC,IAAN,CAAW;AAAEV,QAAAA,OAAO,EAAE3B,8BAA8B,CAACkE,QAAD,CAA9B,CAAyCQ,kBAAzC,CAA4DD,oBAA5D;AAAX,OAAX;AACH,KAFD,MAEO,IAAIA,oBAAJ,EAA0B;AAC7BrC,MAAAA,KAAK,CAACC,IAAN,CAAW;AAAEV,QAAAA,OAAO,EAAE3B,8BAA8B,CAACkE,QAAD,CAA9B,CAAyCS,eAAzC,CAAyDF,oBAAzD;AAAX,OAAX;AACH,KAFM,MAEA,IAAID,qBAAJ,EAA2B;AAC9BpC,MAAAA,KAAK,CAACC,IAAN,CAAW;AAAEV,QAAAA,OAAO,EAAE3B,8BAA8B,CAACkE,QAAD,CAA9B,CAAyCQ,kBAAzC,CAA4Dd;AAAvE,OAAX;AACH;AACJ,GAfD;AAiBA,SAAOxB,KAAP;AACH,CArCD;;AAuCA,IAAMwC,+BAA+B,GAAG,SAAlCA,+BAAkC,CAACxD,QAAD,EAAqBwB,WAArB,EAAkE;AACtG,MAAMR,KAAK,gCACJD,qBAAqB,CAACf,QAAD,CADjB,sBAEJoB,yBAAyB,CAACpB,QAAD,CAFrB,sBAGJyC,mBAAmB,CAACzC,QAAD,CAHf,sBAIJuB,sBAAsB,CAACvB,QAAD,EAAWwB,WAAX,CAJlB,EAAX;AAMA,SAAOR,KAAP;AACH,CARD;;AAUA,SAASjB,+BAAT,EAA0CyD,+BAA1C","sourcesContent":["// @flow\nimport getProp from 'lodash/get';\nimport isNil from 'lodash/isNil';\n\nimport type { Controls, MessageItem } from '../flowTypes';\n\nimport appRestrictionsMessageMap from './appRestrictionsMessageMap';\nimport downloadRestrictionsMessageMap from './downloadRestrictionsMessageMap';\nimport messages from './messages';\nimport { ACCESS_POLICY_RESTRICTION, DOWNLOAD_CONTROL, LIST_ACCESS_LEVEL, SHARED_LINK_ACCESS_LEVEL } from '../constants';\n\nconst { SHARED_LINK, DOWNLOAD, EXTERNAL_COLLAB, APP } = ACCESS_POLICY_RESTRICTION;\nconst { DESKTOP, MOBILE, WEB } = DOWNLOAD_CONTROL;\nconst { BLOCK, WHITELIST, BLACKLIST } = LIST_ACCESS_LEVEL;\nconst { COLLAB_ONLY, COLLAB_AND_COMPANY_ONLY, PUBLIC } = SHARED_LINK_ACCESS_LEVEL;\n\nconst getShortSecurityControlsMessage = (controls: Controls): ?MessageItem => {\n    const { sharedLink, download, externalCollab, app } = controls;\n    // Shared link and external collab restrictions are grouped\n    // together as generic \"sharing\" restrictions\n    const sharing = (sharedLink && sharedLink.accessLevel !== PUBLIC) || externalCollab;\n\n    if (sharing && download && app) {\n        return { message: messages.shortAllRestrictions };\n    }\n\n    if (sharing && download) {\n        return { message: messages.shortSharingDownload };\n    }\n\n    if (sharing && app) {\n        return { message: messages.shortSharingApp };\n    }\n\n    if (download && app) {\n        return { message: messages.shortDownloadApp };\n    }\n\n    if (sharing) {\n        return { message: messages.shortSharing };\n    }\n\n    if (download) {\n        return { message: messages.shortDownload };\n    }\n\n    if (app) {\n        return { message: messages.shortApp };\n    }\n\n    return null;\n};\n\nconst getSharedLinkMessages = (controls: Controls): Array<MessageItem> => {\n    const items = [];\n    const accessLevel = getProp(controls, `${SHARED_LINK}.accessLevel`);\n\n    switch (accessLevel) {\n        case COLLAB_ONLY:\n            items.push({ message: messages.sharingCollabOnly });\n            break;\n        case COLLAB_AND_COMPANY_ONLY:\n            items.push({ message: messages.sharingCollabAndCompanyOnly });\n            break;\n        default:\n            // no-op\n            break;\n    }\n    return items;\n};\n\nconst getExternalCollabMessages = (controls: Controls): Array<MessageItem> => {\n    const items = [];\n    const accessLevel = getProp(controls, `${EXTERNAL_COLLAB}.accessLevel`);\n\n    switch (accessLevel) {\n        case BLOCK:\n            items.push({ message: messages.externalCollabBlock });\n            break;\n        case WHITELIST:\n        case BLACKLIST:\n            items.push({ message: messages.externalCollabDomainList });\n            break;\n        default:\n            // no-op\n            break;\n    }\n    return items;\n};\n\nconst getAppDownloadMessages = (controls: Controls, maxAppCount?: number): Array<MessageItem> => {\n    const items = [];\n    const accessLevel = getProp(controls, `${APP}.accessLevel`);\n\n    switch (accessLevel) {\n        case BLOCK:\n            items.push({ message: messages.appDownloadBlock });\n            break;\n        case WHITELIST:\n        case BLACKLIST: {\n            const apps = getProp(controls, `${APP}.apps`, []);\n\n            maxAppCount = isNil(maxAppCount) ? apps.length : maxAppCount;\n            const appsToDisplay = apps.slice(0, maxAppCount);\n            const remainingAppCount = apps.slice(maxAppCount).length;\n            const appNames = appsToDisplay.map(({ displayText }) => displayText).join(', ');\n\n            if (remainingAppCount) {\n                const appsList = apps.map(({ displayText }) => displayText).join(', ');\n\n                items.push({\n                    message: {\n                        ...appRestrictionsMessageMap[accessLevel].overflow,\n                        values: { appNames, remainingAppCount },\n                    },\n                    tooltipMessage: {\n                        ...messages.allAppNames,\n                        values: { appsList },\n                    },\n                });\n            } else {\n                items.push({\n                    message: {\n                        ...appRestrictionsMessageMap[accessLevel].default,\n                        values: { appNames },\n                    },\n                });\n            }\n            break;\n        }\n        default:\n            // no-op\n            break;\n    }\n    return items;\n};\n\nconst getDownloadMessages = (controls: Controls): Array<MessageItem> => {\n    const items = [];\n    const { web, mobile, desktop } = getProp(controls, DOWNLOAD, {});\n\n    const downloadRestrictions = {\n        [WEB]: {\n            platform: WEB,\n            restrictions: web,\n        },\n        [MOBILE]: {\n            platform: MOBILE,\n            restrictions: mobile,\n        },\n        [DESKTOP]: {\n            platform: DESKTOP,\n            restrictions: desktop,\n        },\n    };\n\n    Object.keys(downloadRestrictions).forEach(platformKey => {\n        const { platform, restrictions } = downloadRestrictions[platformKey];\n\n        if (!restrictions) {\n            return;\n        }\n        const { restrictExternalUsers, restrictManagedUsers } = restrictions;\n\n        if (restrictManagedUsers && restrictExternalUsers) {\n            items.push({ message: downloadRestrictionsMessageMap[platform].externalRestricted[restrictManagedUsers] });\n        } else if (restrictManagedUsers) {\n            items.push({ message: downloadRestrictionsMessageMap[platform].externalAllowed[restrictManagedUsers] });\n        } else if (restrictExternalUsers) {\n            items.push({ message: downloadRestrictionsMessageMap[platform].externalRestricted.default });\n        }\n    });\n\n    return items;\n};\n\nconst getFullSecurityControlsMessages = (controls: Controls, maxAppCount?: number): Array<MessageItem> => {\n    const items = [\n        ...getSharedLinkMessages(controls),\n        ...getExternalCollabMessages(controls),\n        ...getDownloadMessages(controls),\n        ...getAppDownloadMessages(controls, maxAppCount),\n    ];\n    return items;\n};\n\nexport { getShortSecurityControlsMessage, getFullSecurityControlsMessages };\n"],"file":"utils.js"}