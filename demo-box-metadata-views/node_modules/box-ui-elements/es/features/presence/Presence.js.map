{"version":3,"sources":["../../../src/features/presence/Presence.js"],"names":["React","Component","PropTypes","FormattedMessage","injectIntl","classnames","Flyout","Overlay","Tooltip","Button","ARROW_DOWN","ENTER","SPACE","PresenceDropdown","PresenceAvatar","determineInteractionMessage","collaboratorsPropType","flyoutPositionPropType","GROWTH_382_EXPERIMENT_BUCKET","GROWTH_382_AUTOFLY_CLASS","GROWTH_382_AUTOFLY_CLASS_FIRST_LOAD","messages","Presence","activeTooltip","isDropdownActive","showActivityPrompt","Boolean","props","collaborators","length","onClickViewCollaborators","experimentBucket","el","presenceContainerEl","id","onAvatarMouseEnter","setState","onAvatarMouseLeave","event","onFlyoutOpen","onFlyoutClose","stopPropagation","preventDefault","click","key","openDropDown","stopPropagationAndPreventDefault","interactedAt","interactionType","isActive","lastActionMessage","intl","timeAgo","formatRelativeTime","Date","now","formatRelative","activeNowText","name","_renderTimestampMessage","className","maxDisplayedAvatars","maxAdditionalCollaboratorsNum","getLinkCallback","inviteCallback","onFlyoutScroll","avatarAttributes","containerAttributes","flyoutPosition","constrainToScrollParent","constrainToWindow","closeOnWindowBlur","state","presenceCountClassName","onAccessStatsRequested","requestAccessStats","previewPresenceFlyoutAccessStatsLink","overlayClassNames","overlayContent","previewPresenceFlyoutCopy","_showRecentsFlyout","previewPresenceFlyoutActivityCTA","_handleOverlayClose","_handleOverlayOpen","saveRefToContainer","handleKeyDown","slice","map","collaborator","avatarUrl","_renderAvatarTooltip","_hideTooltip","_showTooltip","bind","object","string","arrayOf","isRequired","func","number","bool","any","PresenceComponent"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { FormattedMessage, injectIntl } from 'react-intl';\nimport classnames from 'classnames';\n\nimport { Flyout, Overlay } from '../../components/flyout';\nimport Tooltip from '../../components/tooltip';\n\n// GROWTH-382\nimport Button from '../../components/button';\n\nimport { ARROW_DOWN, ENTER, SPACE } from '../../common/keyboard-events';\n\nimport PresenceDropdown from './PresenceDropdown';\nimport PresenceAvatar from './PresenceAvatar';\nimport { determineInteractionMessage } from './utils/presenceUtils';\nimport { collaboratorsPropType, flyoutPositionPropType } from './propTypes';\n\n// GROWTH-382\nimport {\n    GROWTH_382_EXPERIMENT_BUCKET,\n    GROWTH_382_AUTOFLY_CLASS,\n    GROWTH_382_AUTOFLY_CLASS_FIRST_LOAD,\n} from './constants';\nimport messages from './messages';\n\nimport './Presence.scss';\n\nclass Presence extends Component {\n    /* eslint-disable no-underscore-dangle */\n    static propTypes = {\n        /** Addtional attributes for avatar container */\n        avatarAttributes: PropTypes.object,\n        className: PropTypes.string,\n        collaborators: PropTypes.arrayOf(collaboratorsPropType).isRequired,\n        /** Addtional attributes for presence container */\n        containerAttributes: PropTypes.object,\n        /** Get Link callback */\n        getLinkCallback: PropTypes.func,\n        /** Invite button callback */\n        inviteCallback: PropTypes.func,\n        /** Maximum number of avatars to display before showing a +{n} avatar */\n        maxDisplayedAvatars: PropTypes.number,\n        /** Maximum number of collaborators before displaying a {maxAdditionalCollaboratorsNum}+ avatar */\n        maxAdditionalCollaboratorsNum: PropTypes.number,\n        /** Callback funtion for avatar mouseEnter, argument: id of user */\n        onAvatarMouseEnter: PropTypes.func,\n        /** Callback function for avatar mouseLeave */\n        onAvatarMouseLeave: PropTypes.func,\n        /** Callback funtion for Flyout events, argument: SyntheticEvent */\n        onFlyoutClose: PropTypes.func,\n        onFlyoutOpen: PropTypes.func,\n        onFlyoutScroll: PropTypes.func,\n        /** GROWTH-382 bucketing */\n        experimentBucket: PropTypes.string,\n        /** GROWTH-382 broadcast that the user wants to view stats from the flyout */\n        onAccessStatsRequested: PropTypes.func,\n        /** GROWTH-382 log that the user wants to view collaborators from the flyout */\n        onClickViewCollaborators: PropTypes.func,\n        /** Option to change the orientation of the dropdown. MUST be: bottom-right, bottom-left, bottom-center etc. or in this specific format */\n        flyoutPosition: flyoutPositionPropType,\n        /** Sets the tether constraint to scrollParent for the flyout */\n        constrainToScrollParent: PropTypes.bool,\n        /** Sets the tether constraint to window for the flyout */\n        constrainToWindow: PropTypes.bool,\n        /** Closes the flyout when window loses focus */\n        closeOnWindowBlur: PropTypes.bool,\n        intl: PropTypes.any,\n    };\n\n    static defaultProps = {\n        className: '',\n        maxDisplayedAvatars: 3,\n        maxAdditionalCollaboratorsNum: 99,\n        experimentBucket: null,\n        flyoutPosition: 'bottom-left',\n        constrainToScrollParent: true,\n        constrainToWindow: false,\n        closeOnWindowBlur: false,\n    };\n\n    state = {\n        activeTooltip: null,\n        isDropdownActive: false,\n        showActivityPrompt: Boolean(\n            this.props.collaborators.length &&\n                this.props.onClickViewCollaborators &&\n                this.props.experimentBucket === GROWTH_382_EXPERIMENT_BUCKET,\n        ),\n    };\n\n    saveRefToContainer = el => {\n        this.presenceContainerEl = el;\n    };\n\n    _showTooltip = id => {\n        const { onAvatarMouseEnter } = this.props;\n        this.setState({\n            activeTooltip: id,\n        });\n        if (onAvatarMouseEnter) {\n            onAvatarMouseEnter(id);\n        }\n    };\n\n    _hideTooltip = () => {\n        const { onAvatarMouseLeave } = this.props;\n        this.setState({\n            activeTooltip: null,\n        });\n        if (onAvatarMouseLeave) {\n            onAvatarMouseLeave();\n        }\n    };\n\n    _handleOverlayOpen = event => {\n        const { onFlyoutOpen } = this.props;\n        this.setState({\n            isDropdownActive: true,\n        });\n        if (onFlyoutOpen) {\n            onFlyoutOpen(event);\n        }\n    };\n\n    _handleOverlayClose = event => {\n        const { onFlyoutClose } = this.props;\n        this.setState({\n            isDropdownActive: false,\n        });\n        if (onFlyoutClose) {\n            onFlyoutClose(event);\n        }\n    };\n\n    stopPropagationAndPreventDefault = event => {\n        event.stopPropagation();\n        event.preventDefault();\n    };\n\n    openDropDown = () => {\n        if (this.presenceContainerEl) {\n            this.presenceContainerEl.click();\n        }\n    };\n\n    handleKeyDown = event => {\n        switch (event.key) {\n            case ARROW_DOWN:\n            case ENTER:\n            case SPACE:\n                this.openDropDown();\n                this.stopPropagationAndPreventDefault(event);\n                break;\n\n            default:\n                break;\n        }\n    };\n\n    _renderTimestampMessage = (interactedAt, interactionType, isActive) => {\n        const lastActionMessage = determineInteractionMessage(interactionType);\n        const { intl } = this.props;\n        const timeAgo = intl.formatRelativeTime\n            ? intl.formatRelativeTime(interactedAt - Date.now())\n            : intl.formatRelative(interactedAt);\n\n        if (lastActionMessage) {\n            return (\n                <div>\n                    <span className=\"presence-avatar-tooltip-event\">\n                        {isActive ? (\n                            <FormattedMessage {...messages.activeNowText} />\n                        ) : (\n                            <FormattedMessage\n                                {...lastActionMessage}\n                                values={{\n                                    timeAgo,\n                                }}\n                            />\n                        )}\n                    </span>\n                </div>\n            );\n        }\n        return null;\n    };\n\n    _renderAvatarTooltip = (name, interactedAt, interactionType, isActive) => (\n        <div className=\"presence-avatar-tooltip-container\">\n            <div>\n                <span className=\"presence-avatar-tooltip-name\">{name}</span>\n            </div>\n            {this._renderTimestampMessage(interactedAt, interactionType, isActive)}\n        </div>\n    );\n\n    // GROWTH-382 click through the first CTA, spawn the normal Presence dropdown\n    _showRecentsFlyout = event => {\n        const { onClickViewCollaborators } = this.props;\n        onClickViewCollaborators();\n        this.stopPropagationAndPreventDefault(event);\n        this.setState({ showActivityPrompt: false });\n    };\n\n    render() {\n        const {\n            className,\n            collaborators,\n            maxDisplayedAvatars,\n            maxAdditionalCollaboratorsNum,\n            getLinkCallback,\n            inviteCallback,\n            onFlyoutScroll,\n            avatarAttributes,\n            containerAttributes,\n            flyoutPosition,\n            constrainToScrollParent,\n            constrainToWindow,\n            closeOnWindowBlur,\n        } = this.props;\n\n        const { activeTooltip, isDropdownActive } = this.state;\n        const presenceCountClassName = classnames('presence-avatar', 'avatar', 'presence-count', {\n            'dropdown-active': isDropdownActive,\n        });\n\n        // GROWTH-382\n        const { experimentBucket, onAccessStatsRequested } = this.props;\n        const { showActivityPrompt } = this.state;\n        let requestAccessStats = null;\n\n        if (!showActivityPrompt && experimentBucket === GROWTH_382_EXPERIMENT_BUCKET) {\n            requestAccessStats = (\n                // eslint-disable-next-line jsx-a11y/anchor-is-valid\n                <a className=\"presence-dropdown-request-stats\" href=\"#\" onClick={onAccessStatsRequested}>\n                    <FormattedMessage {...messages.previewPresenceFlyoutAccessStatsLink} />\n                </a>\n            );\n        }\n\n        const overlayClassNames = classnames('presence-dropdown-container', {\n            [GROWTH_382_AUTOFLY_CLASS]: experimentBucket && !showActivityPrompt,\n            [GROWTH_382_AUTOFLY_CLASS_FIRST_LOAD]: experimentBucket && showActivityPrompt,\n        });\n\n        const overlayContent = showActivityPrompt ? (\n            <>\n                <FormattedMessage {...messages.previewPresenceFlyoutCopy} />\n                <Button className=\"btn-primary\" onClick={this._showRecentsFlyout}>\n                    <FormattedMessage {...messages.previewPresenceFlyoutActivityCTA} />\n                </Button>\n            </>\n        ) : (\n            <PresenceDropdown\n                className=\"presence-dropdown\"\n                collaborators={collaborators}\n                experimentBucket={experimentBucket}\n                getLinkCallback={getLinkCallback}\n                inviteCallback={inviteCallback}\n                onScroll={onFlyoutScroll}\n            />\n        );\n        return (\n            <Flyout\n                className={`presence ${className}`}\n                closeOnWindowBlur={closeOnWindowBlur}\n                constrainToScrollParent={constrainToScrollParent}\n                constrainToWindow={constrainToWindow}\n                isVisibleByDefault={showActivityPrompt}\n                onClose={this._handleOverlayClose}\n                onOpen={this._handleOverlayOpen}\n                position={flyoutPosition}\n            >\n                {/* eslint-disable-next-line jsx-a11y/no-static-element-interactions */}\n                <div\n                    ref={this.saveRefToContainer}\n                    className=\"presence-avatar-container\"\n                    onKeyDown={this.handleKeyDown}\n                    {...containerAttributes}\n                >\n                    {collaborators.slice(0, maxDisplayedAvatars).map(collaborator => {\n                        const { id, avatarUrl, name, isActive, interactedAt, interactionType } = collaborator;\n                        return (\n                            <Tooltip\n                                key={id}\n                                isShown={!isDropdownActive && activeTooltip === id}\n                                position=\"bottom-center\"\n                                text={this._renderAvatarTooltip(name, interactedAt, interactionType, isActive)}\n                            >\n                                <PresenceAvatar\n                                    avatarUrl={avatarUrl}\n                                    id={id}\n                                    isActive={isActive}\n                                    name={name}\n                                    onBlur={this._hideTooltip}\n                                    onFocus={this._showTooltip.bind(this, id)}\n                                    onMouseEnter={this._showTooltip.bind(this, id)}\n                                    onMouseLeave={this._hideTooltip}\n                                    {...avatarAttributes}\n                                />\n                            </Tooltip>\n                        );\n                    })}\n\n                    {collaborators.length > maxDisplayedAvatars && (\n                        // eslint-disable-next-line jsx-a11y/no-noninteractive-tabindex\n                        <div className={presenceCountClassName} tabIndex=\"0\" {...avatarAttributes}>\n                            {collaborators.length - maxDisplayedAvatars > maxAdditionalCollaboratorsNum\n                                ? `${maxAdditionalCollaboratorsNum}+`\n                                : `+${collaborators.length - maxDisplayedAvatars}`}\n                        </div>\n                    )}\n                </div>\n                <Overlay className={overlayClassNames} shouldDefaultFocus={false}>\n                    {overlayContent}\n                    {requestAccessStats}\n                </Overlay>\n            </Flyout>\n        );\n    }\n}\n\nexport { Presence as PresenceComponent };\nexport default injectIntl(Presence);\n"],"file":"Presence.js"}