{"version":3,"sources":["../../../src/elements/content-uploader/ContentUploader.js"],"names":["React","Component","classNames","getProp","noop","uniqueid","cloneDeep","getTypedFileId","getTypedFolderId","makeResponsive","Internationalize","FolderUpload","API","getDataTransferItemId","getFileId","getFileFromDataTransferItem","getFile","getFileAPIOptions","getDataTransferItemAPIOptions","isDataTransferItemAFolder","isMultiputSupported","DroppableContent","UploadsManager","Footer","DEFAULT_ROOT","CLIENT_NAME_CONTENT_UPLOADER","DEFAULT_HOSTNAME_UPLOAD","DEFAULT_HOSTNAME_API","VIEW_ERROR","VIEW_UPLOAD_EMPTY","VIEW_UPLOAD_IN_PROGRESS","VIEW_UPLOAD_SUCCESS","STATUS_PENDING","STATUS_IN_PROGRESS","STATUS_STAGED","STATUS_COMPLETE","STATUS_ERROR","ERROR_CODE_UPLOAD_FILE_LIMIT","CHUNKED_UPLOAD_MIN_SIZE_BYTES","FILE_LIMIT_DEFAULT","HIDE_UPLOAD_MANAGER_DELAY_MS_DEFAULT","EXPAND_UPLOADS_MANAGER_ITEMS_NUM_THRESHOLD","UPLOAD_CONCURRENCY","ContentUploader","props","token","sharedLink","sharedLinkPassword","apiHost","uploadHost","clientName","requestInterceptor","responseInterceptor","files","rootFolderId","itemIds","state","Array","from","filter","file","items","item","itemUpdateCallback","isRelativePathIgnored","onBeforeUpload","length","newFiles","getNewFiles","newItemIds","forEach","clearTimeout","resetItemsTimeout","firstFile","setState","webkitRelativePath","addFilesWithRelativePathToQueue","addFilesWithoutRelativePathToQueue","droppedItems","addDataTransferItemsToUploadQueue","addFilesToUploadQueue","dataTransferItems","isFolderUploadEnabled","folderItems","fileItems","isDirectory","push","addFileDataTransferItemsToUploadQueue","addFolderDataTransferItemsToUploadQueue","newItems","getNewDataTransferItems","fileAPIOptions","folderId","folderUpload","getFolderUploadAPI","buildFolderTreeFromDataTransferItem","addFolderToUploadQueue","uploadBaseAPIOptions","getBaseAPIOptions","addToQueue","apiOptions","api","extension","isFolder","name","folder","options","progress","size","status","map","uploadFile","uploadAPIOptions","substr","lastIndexOf","getUploadAPI","uploadItem","fileLimit","useUploadsManager","isUploadsManagerExpanded","updatedItems","prevItemsNum","totalNumOfItems","concat","slice","errorCode","isAutoExpanded","expandUploadsManager","updateViewAndCollection","view","upload","onCancel","cancel","splice","indexOf","minimizeUploadsManager","entries","onUpload","error","boxFile","checkClearUploadItems","onError","index","findIndex","singleItem","errorData","event","total","Math","min","round","loaded","onProgress","chunked","isResumableUploadsEnabled","onClickCancel","onClickResume","onClickRetry","isChunkedUpload","isResumable","sessionId","removeFileFromUploadQueue","bytesUploadedOnLastResume","totalUploadedBytes","resumeFile","resetFile","onClick","onMinimize","resetUploadManagerExpandState","setTimeout","resetUploadsManagerItemsWhenUploadsComplete","id","rootElement","document","getElementById","appElement","hasFiles","isArray","hasItems","hasUploads","addFilesWithOptionsToUploadQueueAndStartUpload","fileId","itemFolderId","itemFileId","buildFolderTreeFromWebkitRelativePath","isUploadFallbackLogicEnabled","factory","createAPIFactory","chunkedUploadAPI","getChunkedUploadAPI","console","warn","plainUploadAPI","getPlainUploadAPI","overwrite","numItemsUploading","item_t","uploadOptions","errorCallback","handleUploadError","progressCallback","handleUploadProgress","successCallback","handleUploadSuccess","onResume","resumeOptions","resume","callback","onComplete","someUploadIsInProgress","some","someUploadHasFailed","allItemsArePending","noFileIsPendingOrInProgress","every","areAllItemsFinished","uploadItemsStatus","language","messages","onClose","className","measureRef","isTouch","isDraggingItemsToUploadsManager","isEmpty","isVisible","isLoading","isDone","styleClassName","be","clickAllWithStatus","toggleUploadsManager","addDroppedItemsToUploadQueue","ContentUploaderComponent"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;;AAMA,OAAO,6BAAP;AACA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,OAAOC,UAAP,MAAuB,YAAvB;AACA,OAAOC,OAAP,MAAoB,YAApB;AACA,OAAOC,IAAP,MAAiB,aAAjB;AACA,OAAOC,QAAP,MAAqB,iBAArB;AACA,OAAOC,SAAP,MAAsB,kBAAtB;AACA,SAASC,cAAT,EAAyBC,gBAAzB,QAAiD,kBAAjD;AACA,OAAOC,cAAP,MAA2B,0BAA3B;AACA,OAAOC,gBAAP,MAA6B,4BAA7B;AACA,OAAOC,YAAP,MAAyB,gCAAzB;AACA,OAAOC,GAAP,MAAgB,WAAhB;AACA,SACIC,qBADJ,EAEIC,SAFJ,EAGIC,2BAHJ,EAIIC,OAJJ,EAKIC,iBALJ,EAMIC,6BANJ,EAOIC,yBAPJ,EAQIC,mBARJ,QASO,qBATP;AAUA,OAAOC,gBAAP,MAA6B,oBAA7B;AACA,OAAOC,cAAP,MAA2B,kBAA3B;AACA,OAAOC,MAAP,MAAmB,UAAnB;AACA,SACIC,YADJ,EAEIC,4BAFJ,EAGIC,uBAHJ,EAIIC,oBAJJ,EAKIC,UALJ,EAMIC,iBANJ,EAOIC,uBAPJ,EAQIC,mBARJ,EASIC,cATJ,EAUIC,kBAVJ,EAWIC,aAXJ,EAYIC,eAZJ,EAaIC,YAbJ,EAcIC,4BAdJ,QAeO,iBAfP;AAyBA,OAAO,sBAAP;AACA,OAAO,qBAAP;AAmDA,IAAMC,6BAA6B,GAAG,SAAtC,C,CAAiD;;AACjD,IAAMC,kBAAkB,GAAG,GAA3B,C,CAAgC;;AAChC,IAAMC,oCAAoC,GAAG,IAA7C;AACA,IAAMC,0CAA0C,GAAG,CAAnD;AACA,IAAMC,kBAAkB,GAAG,CAA3B;;IAEMC,e;;;;;AA6CF;;;;;AAKA,2BAAYC,KAAZ,EAA0B;AAAA;;AAAA;;AACtB,yFAAMA,KAAN;;AADsB,qEArCA,KAqCA;;AAAA,wEAkFN,YAAc;AAAA,wBAU1B,MAAKA,KAVqB;AAAA,UAE1BC,KAF0B,eAE1BA,KAF0B;AAAA,UAG1BC,UAH0B,eAG1BA,UAH0B;AAAA,UAI1BC,kBAJ0B,eAI1BA,kBAJ0B;AAAA,UAK1BC,OAL0B,eAK1BA,OAL0B;AAAA,UAM1BC,UAN0B,eAM1BA,UAN0B;AAAA,UAO1BC,UAP0B,eAO1BA,UAP0B;AAAA,UAQ1BC,kBAR0B,eAQ1BA,kBAR0B;AAAA,UAS1BC,mBAT0B,eAS1BA,mBAT0B;AAY9B,aAAO;AACHP,QAAAA,KAAK,EAALA,KADG;AAEHC,QAAAA,UAAU,EAAVA,UAFG;AAGHC,QAAAA,kBAAkB,EAAlBA,kBAHG;AAIHC,QAAAA,OAAO,EAAPA,OAJG;AAKHC,QAAAA,UAAU,EAAVA,UALG;AAMHC,QAAAA,UAAU,EAAVA,UANG;AAOHC,QAAAA,kBAAkB,EAAlBA,kBAPG;AAQHC,QAAAA,mBAAmB,EAAnBA;AARG,OAAP;AAUH,KAxGyB;;AAAA,kEA+GZ,UAACC,KAAD,EAA2F;AAAA,UAC7FC,YAD6F,GAC5E,MAAKV,KADuE,CAC7FU,YAD6F;AAAA,UAE7FC,OAF6F,GAEjF,MAAKC,KAF4E,CAE7FD,OAF6F;AAIrG,aAAOE,KAAK,CAACC,IAAN,CAAWL,KAAX,EAAkBM,MAAlB,CAAyB,UAAAC,IAAI;AAAA,eAAI,CAACL,OAAO,CAACzC,SAAS,CAAC8C,IAAD,EAAON,YAAP,CAAV,CAAZ;AAAA,OAA7B,CAAP;AACH,KApHyB;;AAAA,8EA2HA,UACtBO,KADsB,EAE2C;AAAA,UACzDP,YADyD,GACxC,MAAKV,KADmC,CACzDU,YADyD;AAAA,UAEzDC,OAFyD,GAE7C,MAAKC,KAFwC,CAEzDD,OAFyD;AAIjE,aAAOE,KAAK,CAACC,IAAN,CAAWG,KAAX,EAAkBF,MAAlB,CAAyB,UAAAG,IAAI;AAAA,eAAI,CAACP,OAAO,CAAC1C,qBAAqB,CAACiD,IAAD,EAAOR,YAAP,CAAtB,CAAZ;AAAA,OAA7B,CAAP;AACH,KAlIyB;;AAAA,4EA6IF,UACpBD,KADoB,EAEpBU,kBAFoB,EAInB;AAAA,UADDC,qBACC,uEADiC,KACjC;AAAA,yBACwC,MAAKpB,KAD7C;AAAA,UACOqB,cADP,gBACOA,cADP;AAAA,UACuBX,YADvB,gBACuBA,YADvB;;AAED,UAAI,CAACD,KAAD,IAAUA,KAAK,CAACa,MAAN,KAAiB,CAA/B,EAAkC;AAC9B;AACH;;AAED,UAAMC,QAAQ,GAAG,MAAKC,WAAL,CAAiBf,KAAjB,CAAjB;;AAEA,UAAIc,QAAQ,CAACD,MAAT,KAAoB,CAAxB,EAA2B;AACvB;AACH;;AAED,UAAMG,UAAU,GAAG,EAAnB;AAEAF,MAAAA,QAAQ,CAACG,OAAT,CAAiB,UAAAV,IAAI,EAAI;AACrBS,QAAAA,UAAU,CAACvD,SAAS,CAAC8C,IAAD,EAAON,YAAP,CAAV,CAAV,GAA4C,IAA5C;AACH,OAFD;AAIAiB,MAAAA,YAAY,CAAC,MAAKC,iBAAN,CAAZ;AAEA,UAAMC,SAAS,GAAGzD,OAAO,CAACmD,QAAQ,CAAC,CAAD,CAAT,CAAzB;;AAEA,YAAKO,QAAL,CACI,UAAAlB,KAAK;AAAA,eAAK;AACND,UAAAA,OAAO,oBACAC,KAAK,CAACD,OADN,MAEAc,UAFA;AADD,SAAL;AAAA,OADT,EAOI,YAAM;AACFJ,QAAAA,cAAc,CAACE,QAAD,CAAd;;AACA,YAAIM,SAAS,CAACE,kBAAV,IAAgC,CAACX,qBAArC,EAA4D;AACxD;AACA,gBAAKY,+BAAL,CAAqCT,QAArC,EAA+CJ,kBAA/C;AACH,SAHD,MAGO;AACH,gBAAKc,kCAAL,CAAwCV,QAAxC,EAAkDJ,kBAAlD;AACH;AACJ,OAfL;AAiBH,KAxLyB;;AAAA,mFAkMK,UAACe,YAAD,EAA6Bf,kBAA7B,EAAoE;AAC/F,UAAIe,YAAY,CAACjB,KAAjB,EAAwB;AACpB,cAAKkB,iCAAL,CAAuCD,YAAY,CAACjB,KAApD,EAA2DE,kBAA3D;AACH,OAFD,MAEO;AACHN,QAAAA,KAAK,CAACC,IAAN,CAAWoB,YAAY,CAACzB,KAAxB,EAA+BiB,OAA/B,CAAuC,UAAAV,IAAI,EAAI;AAC3C,gBAAKoB,qBAAL,CAA2B,CAACpB,IAAD,CAA3B,EAAmCG,kBAAnC;AACH,SAFD;AAGH;AACJ,KA1MyB;;AAAA,wFAoNU,UAChCkB,iBADgC,EAEhClB,kBAFgC,EAGzB;AAAA,UACCmB,qBADD,GAC2B,MAAKtC,KADhC,CACCsC,qBADD;;AAEP,UAAI,CAACD,iBAAD,IAAsBA,iBAAiB,CAACf,MAAlB,KAA6B,CAAvD,EAA0D;AACtD;AACH;;AAED,UAAMiB,WAAW,GAAG,EAApB;AACA,UAAMC,SAAS,GAAG,EAAlB;AAEA3B,MAAAA,KAAK,CAACC,IAAN,CAAWuB,iBAAX,EAA8BX,OAA9B,CAAsC,UAAAR,IAAI,EAAI;AAC1C,YAAMuB,WAAW,GAAGlE,yBAAyB,CAAC2C,IAAD,CAA7C;;AACA,YAAIuB,WAAW,IAAIH,qBAAnB,EAA0C;AACtCC,UAAAA,WAAW,CAACG,IAAZ,CAAiBxB,IAAjB;AACH,SAFD,MAEO,IAAI,CAACuB,WAAL,EAAkB;AACrBD,UAAAA,SAAS,CAACE,IAAV,CAAexB,IAAf;AACH;AACJ,OAPD;;AASA,YAAKyB,qCAAL,CAA2CH,SAA3C,EAAsDrB,kBAAtD;;AACA,YAAKyB,uCAAL,CAA6CL,WAA7C,EAA0DpB,kBAA1D;AACH,KA3OyB;;AAAA,4FAqPc,UACpCkB,iBADoC,EAEpClB,kBAFoC,EAG7B;AACPkB,MAAAA,iBAAiB,CAACX,OAAlB;AAAA;AAAA;AAAA;AAAA;AAAA,gCAA0B,iBAAMR,IAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBACH/C,2BAA2B,CAAC+C,IAAD,CADxB;;AAAA;AAChBF,kBAAAA,IADgB;;AAAA,sBAEjBA,IAFiB;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAMtB,wBAAKoB,qBAAL,CAA2B,CAACpB,IAAD,CAA3B,EAAmCG,kBAAnC;;AANsB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAA1B;;AAAA;AAAA;AAAA;AAAA;AAQH,KAjQyB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8BA2QgB,kBACtCkB,iBADsC,EAEtClB,kBAFsC;AAAA;;AAAA;AAAA;AAAA;AAAA;AAI9BT,gBAAAA,YAJ8B,GAIb,MAAKV,KAJQ,CAI9BU,YAJ8B;AAK9BC,gBAAAA,OAL8B,GAKlB,MAAKC,KALa,CAK9BD,OAL8B;;AAAA,sBAMlC0B,iBAAiB,CAACf,MAAlB,KAA6B,CANK;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAUhCuB,gBAAAA,QAVgC,GAUrB,MAAKC,uBAAL,CAA6BT,iBAA7B,CAVqB;AAWtCQ,gBAAAA,QAAQ,CAACnB,OAAT,CAAiB,UAAAR,IAAI,EAAI;AACrBP,kBAAAA,OAAO,CAAC1C,qBAAqB,CAACiD,IAAD,EAAOR,YAAP,CAAtB,CAAP,GAAqD,IAArD;AACH,iBAFD;;AAXsC,sBAelCmC,QAAQ,CAACvB,MAAT,KAAoB,CAfc;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAmBhCyB,gBAAAA,cAnBgC,GAmBPzE,6BAA6B,CAACuE,QAAQ,CAAC,CAAD,CAAT,CAnBtB;AAAA,wCAoBFE,cApBE,CAoB9BC,QApB8B,EAoB9BA,QApB8B,sCAoBnBtC,YApBmB;AAsBtCmC,gBAAAA,QAAQ,CAACnB,OAAT;AAAA;AAAA;AAAA;AAAA;AAAA,0CAAiB,kBAAMR,IAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AACP+B,4BAAAA,YADO,GACQ,MAAKC,kBAAL,CAAwBF,QAAxB,CADR;AAAA;AAAA,mCAEPC,YAAY,CAACE,mCAAb,CAAiDjC,IAAjD,CAFO;;AAAA;AAGb,kCAAKkC,sBAAL,CAA4BH,YAA5B,EAA0C9B,kBAA1C,EAA8D4B,cAA9D;;AAHa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAAjB;;AAAA;AAAA;AAAA;AAAA;;AAtBsC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OA3QhB;;AAAA;AAAA;AAAA;AAAA;;AAAA,yEAuUL,UAACC,QAAD,EAAoC;AACrD,UAAMK,oBAAoB,GAAG,MAAKC,iBAAL,EAA7B;;AAEA,aAAO,IAAIvF,YAAJ,CAAiB,MAAKqE,qBAAtB,EAA6CY,QAA7C,EAAuD,MAAKO,UAA5D,EAAwEF,oBAAxE,CAAP;AACH,KA3UyB;;AAAA,6EAsVD,UAACJ,YAAD,EAA6B9B,kBAA7B,EAA2DqC,UAA3D,EAAwF;AAC7G,YAAKD,UAAL,CACI,CACI;AACA;AACIE,QAAAA,GAAG,EAAER,YADT;AAEIS,QAAAA,SAAS,EAAE,EAFf;AAGIC,QAAAA,QAAQ,EAAE,IAHd;AAIIC,QAAAA,IAAI,EAAEX,YAAY,CAACY,MAAb,CAAoBD,IAJ9B;AAKIE,QAAAA,OAAO,EAAEN,UALb;AAMIO,QAAAA,QAAQ,EAAE,CANd;AAOIC,QAAAA,IAAI,EAAE,CAPV;AAQIC,QAAAA,MAAM,EAAE7E;AARZ,OAFJ,CADJ,EAcI+B,kBAdJ;AAgBH,KAvWyB;;AAAA,yFAiXW,UACjCV,KADiC,EAEjCU,kBAFiC,EAGhC;AAAA,UACOR,OADP,GACmB,MAAKC,KADxB,CACOD,OADP;AAAA,UAEOD,YAFP,GAEwB,MAAKV,KAF7B,CAEOU,YAFP,EAID;;AACA,UAAMmC,QAAQ,GAAGpC,KAAK,CAACyD,GAAN,CAAU,UAAAlD,IAAI,EAAI;AAC/B,YAAMmD,UAAU,GAAG/F,OAAO,CAAC4C,IAAD,CAA1B;AACA,YAAMoD,gBAAgB,GAAG/F,iBAAiB,CAAC2C,IAAD,CAA1C;AAF+B,YAGvB4C,IAHuB,GAGRO,UAHQ,CAGvBP,IAHuB;AAAA,YAGjBI,IAHiB,GAGRG,UAHQ,CAGjBH,IAHiB,EAK/B;;AACA,YAAIN,SAAS,GAAGE,IAAI,CAACS,MAAL,CAAYT,IAAI,CAACU,WAAL,CAAiB,GAAjB,IAAwB,CAApC,CAAhB;;AACA,YAAIZ,SAAS,CAACpC,MAAV,KAAqBsC,IAAI,CAACtC,MAA9B,EAAsC;AAClCoC,UAAAA,SAAS,GAAG,EAAZ;AACH;;AAED,YAAMD,GAAG,GAAG,MAAKc,YAAL,CAAkBJ,UAAlB,EAA8BC,gBAA9B,CAAZ;;AACA,YAAMI,UAAkB,GAAG;AACvBf,UAAAA,GAAG,EAAHA,GADuB;AAEvBC,UAAAA,SAAS,EAATA,SAFuB;AAGvB1C,UAAAA,IAAI,EAAEmD,UAHiB;AAIvBP,UAAAA,IAAI,EAAJA,IAJuB;AAKvBG,UAAAA,QAAQ,EAAE,CALa;AAMvBC,UAAAA,IAAI,EAAJA,IANuB;AAOvBC,UAAAA,MAAM,EAAE7E;AAPe,SAA3B;;AAUA,YAAIgF,gBAAJ,EAAsB;AAClBI,UAAAA,UAAU,CAACV,OAAX,GAAqBM,gBAArB;AACH;;AAEDzD,QAAAA,OAAO,CAACzC,SAAS,CAACsG,UAAD,EAAa9D,YAAb,CAAV,CAAP,GAA+C,IAA/C;AAEA,eAAO8D,UAAP;AACH,OA7BgB,CAAjB;;AA+BA,UAAI3B,QAAQ,CAACvB,MAAT,KAAoB,CAAxB,EAA2B;AACvB;AACH;;AAED,YAAKQ,QAAL,CAAc;AACVnB,QAAAA,OAAO,EAAPA;AADU,OAAd;;AAGA,YAAK4C,UAAL,CAAgBV,QAAhB,EAA0B1B,kBAA1B;AACH,KAhayB;;AAAA,iEA0ab,UAAC0B,QAAD,EAAyB1B,kBAAzB,EAA0D;AAAA,yBAC1B,MAAKnB,KADqB;AAAA,UAC3DyE,SAD2D,gBAC3DA,SAD2D;AAAA,UAChDC,iBADgD,gBAChDA,iBADgD;AAAA,wBAEvB,MAAK9D,KAFkB;AAAA,UAE3DK,KAF2D,eAE3DA,KAF2D;AAAA,UAEpD0D,wBAFoD,eAEpDA,wBAFoD;AAInE,UAAIC,YAAY,GAAG,EAAnB;AACA,UAAMC,YAAY,GAAG5D,KAAK,CAACK,MAA3B;AACA,UAAMwD,eAAe,GAAGD,YAAY,GAAGhC,QAAQ,CAACvB,MAAhD,CANmE,CAQnE;;AACA,UAAIwD,eAAe,GAAGL,SAAtB,EAAiC;AAC7BG,QAAAA,YAAY,GAAG3D,KAAK,CAAC8D,MAAN,CAAalC,QAAQ,CAACmC,KAAT,CAAe,CAAf,EAAkBP,SAAS,GAAGxD,KAAK,CAACK,MAApC,CAAb,CAAf;;AACA,cAAKQ,QAAL,CAAc;AACVmD,UAAAA,SAAS,EAAExF;AADD,SAAd;AAGH,OALD,MAKO;AACHmF,QAAAA,YAAY,GAAG3D,KAAK,CAAC8D,MAAN,CAAalC,QAAb,CAAf;;AACA,cAAKf,QAAL,CAAc;AAAEmD,UAAAA,SAAS,EAAE;AAAb,SAAd,EAFG,CAIH;;;AACA,YACIJ,YAAY,GAAGhF,0CAAf,IACAiF,eAAe,IAAIjF,0CADnB,IAEA6E,iBAFA,IAGA,CAACC,wBAJL,EAKE;AACE,gBAAKO,cAAL,GAAsB,IAAtB;;AACA,gBAAKC,oBAAL;AACH;AACJ;;AAED,YAAKC,uBAAL,CAA6BR,YAA7B,EAA2C,YAAM;AAC7C,YAAIzD,kBAAJ,EAAwB;AACpBA,UAAAA,kBAAkB;AACrB;;AAH4C,YAKrCkE,IALqC,GAK5B,MAAKzE,KALuB,CAKrCyE,IALqC,EAM7C;;AACA,YAAIA,IAAI,KAAKnG,uBAAb,EAAsC;AAClC,gBAAKoG,MAAL;AACH;AACJ,OAVD;AAWH,KAndyB;;AAAA,gFAmgBE,UAACpE,IAAD,EAAsB;AAAA,yBACN,MAAKlB,KADC;AAAA,UACtCuF,QADsC,gBACtCA,QADsC;AAAA,UAC5Bb,iBAD4B,gBAC5BA,iBAD4B;AAAA,UAEtCzD,KAFsC,GAE5B,MAAKL,KAFuB,CAEtCK,KAFsC,EAG9C;;AACA,YAAKa,QAAL,CAAc;AAAEmD,QAAAA,SAAS,EAAE;AAAb,OAAd;;AAJ8C,UAMtCxB,GANsC,GAM9BvC,IAN8B,CAMtCuC,GANsC;AAO9CA,MAAAA,GAAG,CAAC+B,MAAJ;AAEAvE,MAAAA,KAAK,CAACwE,MAAN,CAAaxE,KAAK,CAACyE,OAAN,CAAcxE,IAAd,CAAb,EAAkC,CAAlC;AAEAqE,MAAAA,QAAQ,CAAC,CAACrE,IAAD,CAAD,CAAR;;AACA,YAAKkE,uBAAL,CAA6BnE,KAA7B,EAAoC,YAAM;AACtC;AACA,YAAIyD,iBAAiB,IAAI,CAACzD,KAAK,CAACK,MAAhC,EAAwC;AACpC,gBAAKqE,sBAAL;AACH;;AAJqC,YAM9BN,IAN8B,GAMrB,MAAKzE,KANgB,CAM9ByE,IAN8B;;AAOtC,YAAIA,IAAI,KAAKnG,uBAAb,EAAsC;AAClC,gBAAKoG,MAAL;AACH;AACJ,OAVD;AAWH,KA1hByB;;AAAA,6DAkiBjB,YAAM;AAAA,UACHrE,KADG,GACO,MAAKL,KADZ,CACHK,KADG;AAEXA,MAAAA,KAAK,CAACS,OAAN,CAAc,UAAA8C,UAAU,EAAI;AAAA,YAChBf,GADgB,GACAe,UADA,CAChBf,GADgB;AAAA,YACXQ,MADW,GACAO,UADA,CACXP,MADW;;AAExB,YAAIA,MAAM,KAAK5E,kBAAf,EAAmC;AAC/BoE,UAAAA,GAAG,CAAC+B,MAAJ;AACH;AACJ,OALD,EAFW,CASX;;AACA,YAAKJ,uBAAL,CAA6B,EAA7B;AACH,KA7iByB;;AAAA,6DAqjBjB,YAAM;AAAA,UACHnE,KADG,GACO,MAAKL,KADZ,CACHK,KADG;AAEXA,MAAAA,KAAK,CAACS,OAAN,CAAc,UAAA8C,UAAU,EAAI;AACxB,YAAIA,UAAU,CAACP,MAAX,KAAsB7E,cAA1B,EAA0C;AACtC,gBAAK+E,UAAL,CAAgBK,UAAhB;AACH;AACJ,OAJD;AAKH,KA5jByB;;AAAA,0EAuqBJ,UAACtD,IAAD,EAAmB0E,OAAnB,EAA2C;AAAA,yBACrB,MAAK5F,KADgB;AAAA,UACrD6F,QADqD,gBACrDA,QADqD;AAAA,UAC3CnB,iBAD2C,gBAC3CA,iBAD2C;AAG7DxD,MAAAA,IAAI,CAAC6C,QAAL,GAAgB,GAAhB;;AACA,UAAI,CAAC7C,IAAI,CAAC4E,KAAV,EAAiB;AACb5E,QAAAA,IAAI,CAAC+C,MAAL,GAAc1E,eAAd;AACH,OAN4D,CAQ7D;;;AACA,UAAIqG,OAAO,IAAIA,OAAO,CAACtE,MAAR,KAAmB,CAAlC,EAAqC;AAAA,sCACfsE,OADe;AAAA,YAC1BG,OAD0B;;AAEjC7E,QAAAA,IAAI,CAAC6E,OAAL,GAAeA,OAAf;AACH;;AAZ4D,UAcrD9E,KAdqD,GAc3C,MAAKL,KAdsC,CAcrDK,KAdqD;AAe7DA,MAAAA,KAAK,CAACA,KAAK,CAACyE,OAAN,CAAcxE,IAAd,CAAD,CAAL,GAA6BA,IAA7B,CAf6D,CAiB7D;;AACA,UAAIwD,iBAAJ,EAAuB;AACnBmB,QAAAA,QAAQ,CAAC3E,IAAD,CAAR;;AACA,cAAK8E,qBAAL;AACH,OAHD,MAGO;AACHH,QAAAA,QAAQ,CAAC3E,IAAI,CAAC6E,OAAN,CAAR;AACH;;AAED,YAAKX,uBAAL,CAA6BnE,KAA7B,EAAoC,YAAM;AAAA,YAC9BoE,IAD8B,GACrB,MAAKzE,KADgB,CAC9ByE,IAD8B;;AAEtC,YAAIA,IAAI,KAAKnG,uBAAb,EAAsC;AAClC,gBAAKoG,MAAL;AACH;AACJ,OALD;AAMH,KAtsByB;;AAAA,oFAwsBM,YAAM;AAClC,YAAKJ,cAAL,GAAsB,KAAtB;;AACA,YAAKpD,QAAL,CAAc;AACV6C,QAAAA,wBAAwB,EAAE;AADhB,OAAd;AAGH,KA7sByB;;AAAA,wEAixBN,UAACzD,IAAD,EAAmB4E,KAAnB,EAAoC;AAAA,yBACb,MAAK9F,KADQ;AAAA,UAC5CiG,OAD4C,gBAC5CA,OAD4C;AAAA,UACnCvB,iBADmC,gBACnCA,iBADmC;AAAA,UAE5C1D,IAF4C,GAEnCE,IAFmC,CAE5CF,IAF4C;AAAA,UAG5CC,KAH4C,GAGlC,MAAKL,KAH6B,CAG5CK,KAH4C;AAKpDC,MAAAA,IAAI,CAAC+C,MAAL,GAAczE,YAAd;AACA0B,MAAAA,IAAI,CAAC4E,KAAL,GAAaA,KAAb;;AAEA,UAAMjD,QAAQ,sBAAO5B,KAAP,CAAd;;AACA,UAAMiF,KAAK,GAAGrD,QAAQ,CAACsD,SAAT,CAAmB,UAAAC,UAAU;AAAA,eAAIA,UAAU,KAAKlF,IAAnB;AAAA,OAA7B,CAAd;;AACA,UAAIgF,KAAK,KAAK,CAAC,CAAf,EAAkB;AACdrD,QAAAA,QAAQ,CAACqD,KAAD,CAAR,GAAkBhF,IAAlB;AACH,OAZmD,CAcpD;;;AACA,UAAMmF,SAAS,GAAG3B,iBAAiB,GAC7B;AACIxD,QAAAA,IAAI,EAAJA,IADJ;AAEI4E,QAAAA,KAAK,EAALA;AAFJ,OAD6B,GAK7B;AACI9E,QAAAA,IAAI,EAAJA,IADJ;AAEI8E,QAAAA,KAAK,EAALA;AAFJ,OALN;AAUAG,MAAAA,OAAO,CAACI,SAAD,CAAP;;AAEA,YAAKjB,uBAAL,CAA6BvC,QAA7B,EAAuC,YAAM;AACzC,YAAI6B,iBAAJ,EAAuB;AACnB,gBAAKQ,cAAL,GAAsB,IAAtB;;AACA,gBAAKC,oBAAL;AACH;;AAJwC,YAKjCE,IALiC,GAKxB,MAAKzE,KALmB,CAKjCyE,IALiC;;AAMzC,YAAIA,IAAI,KAAKnG,uBAAb,EAAsC;AAClC,gBAAKoG,MAAL;AACH;AACJ,OATD;AAUH,KAtzByB;;AAAA,2EAg0BH,UAACpE,IAAD,EAAmBoF,KAAnB,EAAkC;AACrD,UAAI,CAACA,KAAK,CAACC,KAAP,IAAgBrF,IAAI,CAAC+C,MAAL,KAAgB1E,eAAhC,IAAmD2B,IAAI,CAAC+C,MAAL,KAAgB3E,aAAvE,EAAsF;AAClF;AACH;;AAED4B,MAAAA,IAAI,CAAC6C,QAAL,GAAgByC,IAAI,CAACC,GAAL,CAASD,IAAI,CAACE,KAAL,CAAYJ,KAAK,CAACK,MAAN,GAAeL,KAAK,CAACC,KAAtB,GAA+B,GAA1C,CAAT,EAAyD,GAAzD,CAAhB;AACArF,MAAAA,IAAI,CAAC+C,MAAL,GAAc/C,IAAI,CAAC6C,QAAL,KAAkB,GAAlB,GAAwBzE,aAAxB,GAAwCD,kBAAtD;AANqD,UAQ7CuH,UAR6C,GAQ9B,MAAK5G,KARyB,CAQ7C4G,UAR6C;AASrDA,MAAAA,UAAU,CAAC1F,IAAD,CAAV;AATqD,UAW7CD,KAX6C,GAWnC,MAAKL,KAX8B,CAW7CK,KAX6C;AAYrDA,MAAAA,KAAK,CAACA,KAAK,CAACyE,OAAN,CAAcxE,IAAd,CAAD,CAAL,GAA6BA,IAA7B;;AAEA,YAAKkE,uBAAL,CAA6BnE,KAA7B;AACH,KA/0ByB;;AAAA,8DAw1BhB,UAACC,IAAD,EAAsB;AAAA,yBAC+D,MAAKlB,KADpE;AAAA,UACpB6G,OADoB,gBACpBA,OADoB;AAAA,UACXC,yBADW,gBACXA,yBADW;AAAA,UACgBC,aADhB,gBACgBA,aADhB;AAAA,UAC+BC,aAD/B,gBAC+BA,aAD/B;AAAA,UAC8CC,YAD9C,gBAC8CA,YAD9C;AAAA,UAEpBhD,MAFoB,GAEH/C,IAFG,CAEpB+C,MAFoB;AAAA,UAEZjD,IAFY,GAEHE,IAFG,CAEZF,IAFY;AAG5B,UAAMkG,eAAe,GACjBL,OAAO,IAAI,CAAC3F,IAAI,CAACyC,QAAjB,IAA6B3C,IAAI,CAACgD,IAAL,GAAYtE,6BAAzC,IAA0ElB,mBAAmB,EADjG;AAEA,UAAM2I,WAAW,GAAGL,yBAAyB,IAAII,eAA7B,IAAgDhG,IAAI,CAACuC,GAAL,CAAS2D,SAA7E;;AAEA,cAAQnD,MAAR;AACI,aAAK5E,kBAAL;AACA,aAAKC,aAAL;AACA,aAAKC,eAAL;AACA,aAAKH,cAAL;AACI,gBAAKiI,yBAAL,CAA+BnG,IAA/B;;AACA6F,UAAAA,aAAa,CAAC7F,IAAD,CAAb;AACA;;AACJ,aAAK1B,YAAL;AACI,cAAI2H,WAAJ,EAAiB;AACbjG,YAAAA,IAAI,CAACoG,yBAAL,GAAiCpG,IAAI,CAACuC,GAAL,CAAS8D,kBAA1C;;AACA,kBAAKC,UAAL,CAAgBtG,IAAhB;;AACA8F,YAAAA,aAAa,CAAC9F,IAAD,CAAb;AACH,WAJD,MAIO;AACH,kBAAKuG,SAAL,CAAevG,IAAf;;AACA,kBAAKiD,UAAL,CAAgBjD,IAAhB;;AACA+F,YAAAA,YAAY,CAAC/F,IAAD,CAAZ;AACH;;AACD;;AACJ;AACI;AApBR;AAsBH,KAr3ByB;;AAAA,yEA83BL,UAAC+C,MAAD,EAA2B;AAAA,UACpChD,KADoC,GAC1B,MAAKL,KADqB,CACpCK,KADoC;AAG5CA,MAAAA,KAAK,CAACS,OAAN,CAAc,UAAAR,IAAI,EAAI;AAClB,YAAI,CAAC+C,MAAD,IAAW/C,IAAI,CAAC+C,MAAL,KAAgBA,MAA/B,EAAuC;AACnC,gBAAKyD,OAAL,CAAaxG,IAAb;AACH;AACJ,OAJD;AAKH,KAt4ByB;;AAAA,2EA64BH,YAAY;AAAA,UACvBwD,iBADuB,GACD,MAAK1E,KADJ,CACvB0E,iBADuB;;AAG/B,UAAI,CAACA,iBAAL,EAAwB;AACpB;AACH;;AAED/C,MAAAA,YAAY,CAAC,MAAKC,iBAAN,CAAZ;;AAEA,YAAKE,QAAL,CAAc;AAAE6C,QAAAA,wBAAwB,EAAE;AAA5B,OAAd;AACH,KAv5ByB;;AAAA,6EA85BD,YAAY;AAAA,yBACS,MAAK3E,KADd;AAAA,UACzB0E,iBADyB,gBACzBA,iBADyB;AAAA,UACNiD,UADM,gBACNA,UADM;;AAGjC,UAAI,CAACjD,iBAAD,IAAsB,CAACiD,UAA3B,EAAuC;AACnC;AACH;;AAEDhG,MAAAA,YAAY,CAAC,MAAKC,iBAAN,CAAZ;AAEA+F,MAAAA,UAAU;;AACV,YAAKC,6BAAL;;AACA,YAAK5B,qBAAL;AACH,KA16ByB;;AAAA,4EAi7BF,YAAM;AAC1B,YAAKpE,iBAAL,GAAyBiG,UAAU,CAC/B,MAAKC,2CAD0B,EAE/BlI,oCAF+B,CAAnC;AAIH,KAt7ByB;;AAAA,2EA67BH,YAAY;AAAA,UACvB+E,wBADuB,GACM,MAAK/D,KADX,CACvB+D,wBADuB;;AAG/B,UAAIA,wBAAJ,EAA8B;AAC1B,cAAKgB,sBAAL;AACH,OAFD,MAEO;AACH,cAAKR,oBAAL;AACH;AACJ,KAr8ByB;;AAAA,kGA48BoB,YAAY;AAAA,yBACJ,MAAKvE,KADD;AAAA,UAC9CyE,IAD8C,gBAC9CA,IAD8C;AAAA,UACxCpE,KADwC,gBACxCA,KADwC;AAAA,UACjC0D,wBADiC,gBACjCA,wBADiC;AAAA,yBAEd,MAAK3E,KAFS;AAAA,UAE9C0E,iBAF8C,gBAE9CA,iBAF8C;AAAA,UAE3Ba,QAF2B,gBAE3BA,QAF2B,EAItD;;AACA,UAAKZ,wBAAwB,IAAID,iBAA5B,IAAiD,CAAC,CAACzD,KAAK,CAACK,MAA1D,IAAqE+D,IAAI,KAAKnG,uBAAlF,EAA2G;AACvG;AACH;;AAEDqG,MAAAA,QAAQ,CAACtE,KAAD,CAAR;;AAEA,YAAKa,QAAL,CAAc;AACVb,QAAAA,KAAK,EAAE,EADG;AAEVN,QAAAA,OAAO,EAAE;AAFC,OAAd;AAIH,KA39ByB;;AAAA,qGAm+BuB,UAC7CF,KAD6C,EAE7C4B,iBAF6C,EAGtC;AACP,YAAKD,qBAAL,CAA2B3B,KAA3B,EAAkC,MAAK6E,MAAvC;;AACA,YAAKnD,iCAAL,CAAuCE,iBAAvC,EAA0D,MAAKiD,MAA/D;AACH,KAz+ByB;;AAAA,QAGd5E,aAHc,GAG6BV,KAH7B,CAGdU,YAHc;AAAA,QAGAT,MAHA,GAG6BD,KAH7B,CAGAC,KAHA;AAAA,QAGOyE,kBAHP,GAG6B1E,KAH7B,CAGO0E,iBAHP;AAItB,UAAK9D,KAAL,GAAa;AACTyE,MAAAA,IAAI,EAAG3E,aAAY,IAAIT,MAAjB,IAA2ByE,kBAA3B,GAA+CzF,iBAA/C,GAAmED,UADhE;AAETiC,MAAAA,KAAK,EAAE,EAFE;AAGTgE,MAAAA,SAAS,EAAE,EAHF;AAITtE,MAAAA,OAAO,EAAE,EAJA;AAKTgE,MAAAA,wBAAwB,EAAE;AALjB,KAAb;AAOA,UAAKoD,EAAL,GAAUtK,QAAQ,CAAC,MAAD,CAAlB;AAXsB;AAYzB;AAED;;;;;;;;;;;wCAOoB;AAChB,WAAKuK,WAAL,GAAqBC,QAAQ,CAACC,cAAT,CAAwB,KAAKH,EAA7B,CAArB;AACA,WAAKI,UAAL,GAAkB,KAAKH,WAAvB;AACH;AAED;;;;;;;;;;2CAOuB;AACnB,WAAKxC,MAAL;AACH;AAED;;;;;;;;yCAK2B;AAAA,0BACiC,KAAKxF,KADtC;AAAA,UACfS,KADe,iBACfA,KADe;AAAA,UACR4B,iBADQ,iBACRA,iBADQ;AAAA,UACWqC,iBADX,iBACWA,iBADX;AAGvB,UAAM0D,QAAQ,GAAGvH,KAAK,CAACwH,OAAN,CAAc5H,KAAd,KAAwBA,KAAK,CAACa,MAAN,GAAe,CAAxD;AACA,UAAMgH,QAAQ,GAAGzH,KAAK,CAACwH,OAAN,CAAchG,iBAAd,KAAoCA,iBAAiB,CAACf,MAAlB,GAA2B,CAAhF;AACA,UAAMiH,UAAU,GAAGH,QAAQ,IAAIE,QAA/B;;AAEA,UAAI,CAAC5D,iBAAD,IAAsB,CAAC6D,UAA3B,EAAuC;AACnC;AACH;;AAED,WAAKC,8CAAL,CAAoD/H,KAApD,EAA2D4B,iBAA3D;AACH;AAED;;;;;;;;;qCAMiB+B,gB,EAA8C;AAAA,UACnD1D,YADmD,GAClC,KAAKV,KAD6B,CACnDU,YADmD;AAE3D,UAAMsC,QAAQ,GAAGzF,OAAO,CAAC6G,gBAAD,EAAmB,UAAnB,CAAP,IAAyC1D,YAA1D;AACA,UAAM+H,MAAM,GAAGlL,OAAO,CAAC6G,gBAAD,EAAmB,QAAnB,CAAtB;AACA,UAAMsE,YAAY,GAAG9K,gBAAgB,CAACoF,QAAD,CAArC;AACA,UAAM2F,UAAU,GAAGF,MAAM,GAAG9K,cAAc,CAAC8K,MAAD,CAAjB,GAA4B,IAArD;AAEA,aAAO,IAAIzK,GAAJ,mBACA,KAAKsF,iBAAL,EADA;AAEHyE,QAAAA,EAAE,EAAEY,UAAU,IAAID;AAFf,SAGAtE,gBAHA,EAAP;AAKH;AAED;;;;;;;;;;AA4NA;;;;;;;;oDAQgC3D,K,EAA+CU,kB,EAA8B;AACzG,UAAIV,KAAK,CAACa,MAAN,KAAiB,CAArB,EAAwB;AACpB;AACH;;AAHwG,UAKjGZ,YALiG,GAKhF,KAAKV,KAL2E,CAKjGU,YALiG;AAMzG,UAAMqC,cAAsB,GAAG1E,iBAAiB,CAACoC,KAAK,CAAC,CAAD,CAAN,CAAhD;AANyG,mCAOrEsC,cAPqE,CAOjGC,QAPiG;AAAA,UAOjGA,QAPiG,uCAOtFtC,YAPsF;AAQzG,UAAMuC,YAAY,GAAG,KAAKC,kBAAL,CAAwBF,QAAxB,CAArB,CARyG,CAUzG;;AACAC,MAAAA,YAAY,CAAC2F,qCAAb,CAAmDnI,KAAnD;AAEA,WAAK2C,sBAAL,CAA4BH,YAA5B,EAA0C9B,kBAA1C,EAA8D4B,cAA9D;AACH;AAED;;;;;;;;;;;AAqJA;;;;;;;;iCAQa/B,I,EAAYoD,gB,EAAyC;AAAA,0BACe,KAAKpE,KADpB;AAAA,UACtD6G,OADsD,iBACtDA,OADsD;AAAA,UAC7CC,yBAD6C,iBAC7CA,yBAD6C;AAAA,UAClB+B,4BADkB,iBAClBA,4BADkB;AAAA,UAEtD7E,IAFsD,GAE7ChD,IAF6C,CAEtDgD,IAFsD;AAG9D,UAAM8E,OAAO,GAAG,KAAKC,gBAAL,CAAsB3E,gBAAtB,CAAhB;;AAEA,UAAIyC,OAAO,IAAI7C,IAAI,GAAGtE,6BAAtB,EAAqD;AACjD,YAAIlB,mBAAmB,EAAvB,EAA2B;AACvB,cAAMwK,gBAAgB,GAAGF,OAAO,CAACG,mBAAR,EAAzB;;AACA,cAAInC,yBAAJ,EAA+B;AAC3BkC,YAAAA,gBAAgB,CAAClC,yBAAjB,GAA6C,IAA7C;AACH;;AACD,cAAI+B,4BAAJ,EAAkC;AAC9BG,YAAAA,gBAAgB,CAACH,4BAAjB,GAAgD,IAAhD;AACH;;AACD,iBAAOG,gBAAP;AACH;AAED;;;AACAE,QAAAA,OAAO,CAACC,IAAR,CACI,gGADJ;AAGA;AACH;;AAED,UAAMC,cAAc,GAAGN,OAAO,CAACO,iBAAR,EAAvB;;AACA,UAAIR,4BAAJ,EAAkC;AAC9BO,QAAAA,cAAc,CAACP,4BAAf,GAA8C,IAA9C;AACH;;AAED,aAAOO,cAAP;AACH;AAED;;;;;;;;;;AAiEA;;;;;;+BAMWlI,I,EAAkB;AAAA;;AAAA,0BACW,KAAKlB,KADhB;AAAA,UACjBsJ,SADiB,iBACjBA,SADiB;AAAA,UACN5I,YADM,iBACNA,YADM;AAAA,UAEjB+C,GAFiB,GAEMvC,IAFN,CAEjBuC,GAFiB;AAAA,UAEZzC,IAFY,GAEME,IAFN,CAEZF,IAFY;AAAA,UAEN8C,OAFM,GAEM5C,IAFN,CAEN4C,OAFM;AAAA,UAGjB7C,KAHiB,GAGP,KAAKL,KAHE,CAGjBK,KAHiB;AAKzB,UAAMsI,iBAAiB,GAAGtI,KAAK,CAACF,MAAN,CAAa,UAAAyI,MAAM;AAAA,eAAIA,MAAM,CAACvF,MAAP,KAAkB5E,kBAAtB;AAAA,OAAnB,EAA6DiC,MAAvF;;AAEA,UAAIiI,iBAAiB,IAAIzJ,kBAAzB,EAA6C;AACzC;AACH;;AAED,UAAM2J,aAAqB,GAAG;AAC1BzI,QAAAA,IAAI,EAAJA,IAD0B;AAE1BgC,QAAAA,QAAQ,EAAEc,OAAO,IAAIA,OAAO,CAACd,QAAnB,GAA8Bc,OAAO,CAACd,QAAtC,GAAiDtC,YAFjC;AAG1BgJ,QAAAA,aAAa,EAAE,uBAAA5D,KAAK;AAAA,iBAAI,MAAI,CAAC6D,iBAAL,CAAuBzI,IAAvB,EAA6B4E,KAA7B,CAAJ;AAAA,SAHM;AAI1B8D,QAAAA,gBAAgB,EAAE,0BAAAtD,KAAK;AAAA,iBAAI,MAAI,CAACuD,oBAAL,CAA0B3I,IAA1B,EAAgCoF,KAAhC,CAAJ;AAAA,SAJG;AAK1BwD,QAAAA,eAAe,EAAE,yBAAAlE,OAAO;AAAA,iBAAI,MAAI,CAACmE,mBAAL,CAAyB7I,IAAzB,EAA+B0E,OAA/B,CAAJ;AAAA,SALE;AAM1B0D,QAAAA,SAAS,EAATA,SAN0B;AAO1Bb,QAAAA,MAAM,EAAE3E,OAAO,IAAIA,OAAO,CAAC2E,MAAnB,GAA4B3E,OAAO,CAAC2E,MAApC,GAA6C;AAP3B,OAA9B;AAUAvH,MAAAA,IAAI,CAAC+C,MAAL,GAAc5E,kBAAd;AACA4B,MAAAA,KAAK,CAACA,KAAK,CAACyE,OAAN,CAAcxE,IAAd,CAAD,CAAL,GAA6BA,IAA7B;AAEAuC,MAAAA,GAAG,CAAC6B,MAAJ,CAAWmE,aAAX;AAEA,WAAKrE,uBAAL,CAA6BnE,KAA7B;AACH;AAED;;;;;;;;;+BAMWC,I,EAAkB;AAAA;;AAAA,0BACqB,KAAKlB,KAD1B;AAAA,UACjBsJ,SADiB,iBACjBA,SADiB;AAAA,UACN5I,YADM,iBACNA,YADM;AAAA,UACQsJ,QADR,iBACQA,QADR;AAAA,UAEjBvG,GAFiB,GAEMvC,IAFN,CAEjBuC,GAFiB;AAAA,UAEZzC,IAFY,GAEME,IAFN,CAEZF,IAFY;AAAA,UAEN8C,OAFM,GAEM5C,IAFN,CAEN4C,OAFM;AAAA,UAGjB7C,KAHiB,GAGP,KAAKL,KAHE,CAGjBK,KAHiB;AAKzB,UAAMsI,iBAAiB,GAAGtI,KAAK,CAACF,MAAN,CAAa,UAAAyI,MAAM;AAAA,eAAIA,MAAM,CAACvF,MAAP,KAAkB5E,kBAAtB;AAAA,OAAnB,EAA6DiC,MAAvF;;AAEA,UAAIiI,iBAAiB,IAAIzJ,kBAAzB,EAA6C;AACzC;AACH;;AAED,UAAMmK,aAAqB,GAAG;AAC1BjJ,QAAAA,IAAI,EAAJA,IAD0B;AAE1BgC,QAAAA,QAAQ,EAAEc,OAAO,IAAIA,OAAO,CAACd,QAAnB,GAA8Bc,OAAO,CAACd,QAAtC,GAAiDtC,YAFjC;AAG1BgJ,QAAAA,aAAa,EAAE,uBAAA5D,KAAK;AAAA,iBAAI,MAAI,CAAC6D,iBAAL,CAAuBzI,IAAvB,EAA6B4E,KAA7B,CAAJ;AAAA,SAHM;AAI1B8D,QAAAA,gBAAgB,EAAE,0BAAAtD,KAAK;AAAA,iBAAI,MAAI,CAACuD,oBAAL,CAA0B3I,IAA1B,EAAgCoF,KAAhC,CAAJ;AAAA,SAJG;AAK1BwD,QAAAA,eAAe,EAAE,yBAAAlE,OAAO;AAAA,iBAAI,MAAI,CAACmE,mBAAL,CAAyB7I,IAAzB,EAA+B0E,OAA/B,CAAJ;AAAA,SALE;AAM1B0D,QAAAA,SAAS,EAATA,SAN0B;AAO1BlC,QAAAA,SAAS,EAAE3D,GAAG,IAAIA,GAAG,CAAC2D,SAAX,GAAuB3D,GAAG,CAAC2D,SAA3B,GAAuC,IAPxB;AAQ1BqB,QAAAA,MAAM,EAAE3E,OAAO,IAAIA,OAAO,CAAC2E,MAAnB,GAA4B3E,OAAO,CAAC2E,MAApC,GAA6C;AAR3B,OAA9B;AAWAvH,MAAAA,IAAI,CAAC+C,MAAL,GAAc5E,kBAAd;AACA,aAAO6B,IAAI,CAAC4E,KAAZ;AACA7E,MAAAA,KAAK,CAACA,KAAK,CAACyE,OAAN,CAAcxE,IAAd,CAAD,CAAL,GAA6BA,IAA7B;AAEA8I,MAAAA,QAAQ,CAAC9I,IAAD,CAAR;AACAuC,MAAAA,GAAG,CAACyG,MAAJ,CAAWD,aAAX;AAEA,WAAK7E,uBAAL,CAA6BnE,KAA7B;AACH;AAED;;;;;;;;;8BAMUC,I,EAAkB;AAAA,UAChBuC,GADgB,GACOvC,IADP,CAChBuC,GADgB;AAAA,UACXzC,IADW,GACOE,IADP,CACXF,IADW;AAAA,UACL8C,OADK,GACO5C,IADP,CACL4C,OADK;;AAExB,UAAIL,GAAG,IAAI,OAAOA,GAAG,CAAC+B,MAAX,KAAsB,UAAjC,EAA6C;AACzC/B,QAAAA,GAAG,CAAC+B,MAAJ;AACH,OAJuB,CAMxB;;;AACAtE,MAAAA,IAAI,CAACuC,GAAL,GAAW,KAAKc,YAAL,CAAkBvD,IAAlB,EAAwB8C,OAAxB,CAAX;AACA5C,MAAAA,IAAI,CAAC6C,QAAL,GAAgB,CAAhB;AACA7C,MAAAA,IAAI,CAAC+C,MAAL,GAAc7E,cAAd;AACA,aAAO8B,IAAI,CAAC4E,KAAZ;AAVwB,UAYhB7E,KAZgB,GAYN,KAAKL,KAZC,CAYhBK,KAZgB;AAaxBA,MAAAA,KAAK,CAACA,KAAK,CAACyE,OAAN,CAAcxE,IAAd,CAAD,CAAL,GAA6BA,IAA7B;AAEA,WAAKkE,uBAAL,CAA6BnE,KAA7B;AACH;AAED;;;;;;;;;;;;AAgDA;;;;;;;;4CAQwBA,K,EAAqBkJ,Q,EAAqB;AAAA,0BACc,KAAKnK,KADnB;AAAA,UACtDoK,UADsD,iBACtDA,UADsD;AAAA,UAC1C1F,iBAD0C,iBAC1CA,iBAD0C;AAAA,UACvBoC,yBADuB,iBACvBA,yBADuB;AAE9D,UAAMuD,sBAAsB,GAAGpJ,KAAK,CAACqJ,IAAN,CAAW,UAAA9F,UAAU;AAAA,eAAIA,UAAU,CAACP,MAAX,KAAsB1E,eAA1B;AAAA,OAArB,CAA/B;AACA,UAAMgL,mBAAmB,GAAGtJ,KAAK,CAACqJ,IAAN,CAAW,UAAA9F,UAAU;AAAA,eAAIA,UAAU,CAACP,MAAX,KAAsBzE,YAA1B;AAAA,OAArB,CAA5B;AACA,UAAMgL,kBAAkB,GAAG,CAACvJ,KAAK,CAACqJ,IAAN,CAAW,UAAA9F,UAAU;AAAA,eAAIA,UAAU,CAACP,MAAX,KAAsB7E,cAA1B;AAAA,OAArB,CAA5B;AACA,UAAMqL,2BAA2B,GAAGxJ,KAAK,CAACyJ,KAAN,CAChC,UAAAlG,UAAU;AAAA,eAAIA,UAAU,CAACP,MAAX,KAAsB7E,cAAtB,IAAwCoF,UAAU,CAACP,MAAX,KAAsB5E,kBAAlE;AAAA,OADsB,CAApC;AAGA,UAAMsL,mBAAmB,GAAG1J,KAAK,CAACyJ,KAAN,CACxB,UAAAlG,UAAU;AAAA,eAAIA,UAAU,CAACP,MAAX,KAAsB1E,eAAtB,IAAyCiF,UAAU,CAACP,MAAX,KAAsBzE,YAAnE;AAAA,OADc,CAA5B;AAGA,UAAMoL,iBAAiB,GAAG9D,yBAAyB,GAAG6D,mBAAH,GAAyBF,2BAA5E;AAEA,UAAIpF,IAAI,GAAG,EAAX;;AACA,UAAKpE,KAAK,IAAIA,KAAK,CAACK,MAAN,KAAiB,CAA3B,IAAiCkJ,kBAArC,EAAyD;AACrDnF,QAAAA,IAAI,GAAGpG,iBAAP;AACH,OAFD,MAEO,IAAIsL,mBAAmB,IAAI7F,iBAA3B,EAA8C;AACjDW,QAAAA,IAAI,GAAGrG,UAAP;AACH,OAFM,MAEA,IAAIqL,sBAAJ,EAA4B;AAC/BhF,QAAAA,IAAI,GAAGnG,uBAAP;AACH,OAFM,MAEA;AACHmG,QAAAA,IAAI,GAAGlG,mBAAP;;AAEA,YAAI,CAACuF,iBAAL,EAAwB;AACpB0F,UAAAA,UAAU,CAAC1M,SAAS,CAACuD,KAAK,CAACiD,GAAN,CAAU,UAAAhD,IAAI;AAAA,mBAAIA,IAAI,CAAC6E,OAAT;AAAA,WAAd,CAAD,CAAV,CAAV,CADoB,CAEpB;;AACA9E,UAAAA,KAAK,GAAG,EAAR;AACH;AACJ;;AAED,UAAI2J,iBAAiB,IAAIlG,iBAAzB,EAA4C;AACxC,YAAI,KAAKQ,cAAT,EAAyB;AACrB,eAAK0C,6BAAL;AACH,SAHuC,CAGtC;;;AACFwC,QAAAA,UAAU,CAACnJ,KAAD,CAAV;AACH;;AAED,UAAML,KAAa,GAAG;AAClBK,QAAAA,KAAK,EAALA,KADkB;AAElBoE,QAAAA,IAAI,EAAJA;AAFkB,OAAtB;;AAKA,UAAIpE,KAAK,CAACK,MAAN,KAAiB,CAArB,EAAwB;AACpBV,QAAAA,KAAK,CAACD,OAAN,GAAgB,EAAhB;AACAC,QAAAA,KAAK,CAACqE,SAAN,GAAkB,EAAlB;AACH;;AAED,WAAKnD,QAAL,CAAclB,KAAd,EAAqBuJ,QAArB;AACH;AAED;;;;;;;;;;;;AAkOA;;;;;;6BAMS;AAAA,0BAaM,KAAKnK,KAbX;AAAA,UAED6K,QAFC,iBAEDA,QAFC;AAAA,UAGDC,QAHC,iBAGDA,QAHC;AAAA,UAIDC,OAJC,iBAIDA,OAJC;AAAA,UAKDC,SALC,iBAKDA,SALC;AAAA,UAMDC,UANC,iBAMDA,UANC;AAAA,UAODC,OAPC,iBAODA,OAPC;AAAA,UAQDzG,SARC,iBAQDA,SARC;AAAA,UASDC,iBATC,iBASDA,iBATC;AAAA,UAUDoC,yBAVC,iBAUDA,yBAVC;AAAA,UAWDxE,qBAXC,iBAWDA,qBAXC;AAAA,gDAYD6I,+BAZC;AAAA,UAYDA,+BAZC,sCAYiC,KAZjC;AAAA,yBAc+D,KAAKvK,KAdpE;AAAA,UAcGyE,IAdH,gBAcGA,IAdH;AAAA,UAcSpE,KAdT,gBAcSA,KAdT;AAAA,UAcgBgE,SAdhB,gBAcgBA,SAdhB;AAAA,UAc2BN,wBAd3B,gBAc2BA,wBAd3B;AAeL,UAAMyG,OAAO,GAAGnK,KAAK,CAACK,MAAN,KAAiB,CAAjC;AACA,UAAM+J,SAAS,GAAG,CAACD,OAAD,IAAY,CAAC,CAACD,+BAAhC;AAEA,UAAM/C,QAAQ,GAAGnH,KAAK,CAACK,MAAN,KAAiB,CAAlC;AACA,UAAMgK,SAAS,GAAGrK,KAAK,CAACqJ,IAAN,CAAW,UAAApJ,IAAI;AAAA,eAAIA,IAAI,CAAC+C,MAAL,KAAgB5E,kBAApB;AAAA,OAAf,CAAlB;AACA,UAAMkM,MAAM,GAAGtK,KAAK,CAACyJ,KAAN,CAAY,UAAAxJ,IAAI;AAAA,eAAIA,IAAI,CAAC+C,MAAL,KAAgB1E,eAAhB,IAAmC2B,IAAI,CAAC+C,MAAL,KAAgB3E,aAAvD;AAAA,OAAhB,CAAf;AAEA,UAAMkM,cAAc,GAAGlO,UAAU,CAAC,KAAD,EAAQ0N,SAAR,EAAmB;AAChD,0BAAkB,CAACtG,iBAD6B;AAEhD+G,QAAAA,EAAE,EAAE,CAAC/G;AAF2C,OAAnB,CAAjC;AAKA,aACI,oBAAC,gBAAD;AAAkB,QAAA,QAAQ,EAAEmG,QAA5B;AAAsC,QAAA,QAAQ,EAAEC;AAAhD,SACKpG,iBAAiB,GACd;AAAK,QAAA,GAAG,EAAEuG,UAAV;AAAsB,QAAA,SAAS,EAAEO,cAAjC;AAAiD,QAAA,EAAE,EAAE,KAAKzD;AAA1D,SACI,oBAAC,cAAD;AACI,QAAA,UAAU,EAAEoD,+BADhB;AAEI,QAAA,UAAU,EAAExG,wBAFhB;AAGI,QAAA,yBAAyB,EAAEmC,yBAH/B;AAII,QAAA,SAAS,EAAEuE,SAJf;AAKI,QAAA,KAAK,EAAEpK,KALX;AAMI,QAAA,iBAAiB,EAAE,KAAKyG,OAN5B;AAOI,QAAA,mBAAmB,EAAE,KAAKL,yBAP9B;AAQI,QAAA,2BAA2B,EAAE,KAAKqE,kBARtC;AASI,QAAA,oBAAoB,EAAE,KAAKC,oBAT/B;AAUI,QAAA,IAAI,EAAEtG;AAVV,QADJ,CADc,GAgBd;AAAK,QAAA,GAAG,EAAE4F,UAAV;AAAsB,QAAA,SAAS,EAAEO,cAAjC;AAAiD,QAAA,EAAE,EAAE,KAAKzD;AAA1D,SACI,oBAAC,gBAAD;AACI,QAAA,iCAAiC,EAAE,KAAK6D,4BAD5C;AAEI,QAAA,QAAQ,EAAE,KAAKxJ,qBAFnB;AAGI,QAAA,YAAY,EAAE,CAAC,OAAD,CAHlB;AAII,QAAA,qBAAqB,EAAEE,qBAJ3B;AAKI,QAAA,OAAO,EAAE4I,OALb;AAMI,QAAA,KAAK,EAAEjK,KANX;AAOI,QAAA,OAAO,EAAE,KAAKyG,OAPlB;AAQI,QAAA,IAAI,EAAErC;AARV,QADJ,EAWI,oBAAC,MAAD;AACI,QAAA,SAAS,EAAEJ,SADf;AAEI,QAAA,SAAS,EAAER,SAFf;AAGI,QAAA,QAAQ,EAAE2D,QAHd;AAII,QAAA,SAAS,EAAEkD,SAJf;AAKI,QAAA,QAAQ,EAAE,KAAK9F,MALnB;AAMI,QAAA,OAAO,EAAEuF,OANb;AAOI,QAAA,QAAQ,EAAE,KAAKzF,MAPnB;AAQI,QAAA,MAAM,EAAEiG;AARZ,QAXJ,CAjBR,CADJ;AA2CH;;;;EAzmCyBlO,S;;gBAAxB0C,e,kBAeoB;AAClBW,EAAAA,YAAY,EAAE9B,YADI;AAElBwB,EAAAA,OAAO,EAAErB,oBAFS;AAGlB8H,EAAAA,OAAO,EAAE,IAHS;AAIlBmE,EAAAA,SAAS,EAAE,EAJO;AAKlB1K,EAAAA,UAAU,EAAEzB,4BALM;AAMlB4F,EAAAA,SAAS,EAAE9E,kBANO;AAOlBU,EAAAA,UAAU,EAAEvB,uBAPM;AAQlBuC,EAAAA,cAAc,EAAE7D,IARE;AASlBuJ,EAAAA,aAAa,EAAEvJ,IATG;AAUlBwJ,EAAAA,aAAa,EAAExJ,IAVG;AAWlByJ,EAAAA,YAAY,EAAEzJ,IAXI;AAYlBuN,EAAAA,OAAO,EAAEvN,IAZS;AAalB4M,EAAAA,UAAU,EAAE5M,IAbM;AAclByI,EAAAA,OAAO,EAAEzI,IAdS;AAelBwM,EAAAA,QAAQ,EAAExM,IAfQ;AAgBlBqI,EAAAA,QAAQ,EAAErI,IAhBQ;AAiBlBoJ,EAAAA,UAAU,EAAEpJ,IAjBM;AAkBlB8L,EAAAA,SAAS,EAAE,IAlBO;AAmBlB5E,EAAAA,iBAAiB,EAAE,KAnBD;AAoBlBjE,EAAAA,KAAK,EAAE,EApBW;AAqBlBkH,EAAAA,UAAU,EAAEnK,IArBM;AAsBlB+H,EAAAA,QAAQ,EAAE/H,IAtBQ;AAuBlB8E,EAAAA,qBAAqB,EAAE,KAvBL;AAwBlBwE,EAAAA,yBAAyB,EAAE,KAxBT;AAyBlB+B,EAAAA,4BAA4B,EAAE,KAzBZ;AA0BlBxG,EAAAA,iBAAiB,EAAE,EA1BD;AA2BlB8I,EAAAA,+BAA+B,EAAE;AA3Bf,C;;AA8lC1B,eAAetN,cAAc,CAACkC,eAAD,CAA7B;AACA,SAASA,eAAe,IAAI8L,wBAA5B,EAAsDnM,6BAAtD","sourcesContent":["/**\n * @flow\n * @file Content Uploader component\n * @author Box\n */\n\nimport 'regenerator-runtime/runtime';\nimport React, { Component } from 'react';\nimport classNames from 'classnames';\nimport getProp from 'lodash/get';\nimport noop from 'lodash/noop';\nimport uniqueid from 'lodash/uniqueId';\nimport cloneDeep from 'lodash/cloneDeep';\nimport { getTypedFileId, getTypedFolderId } from '../../utils/file';\nimport makeResponsive from '../common/makeResponsive';\nimport Internationalize from '../common/Internationalize';\nimport FolderUpload from '../../api/uploads/FolderUpload';\nimport API from '../../api';\nimport {\n    getDataTransferItemId,\n    getFileId,\n    getFileFromDataTransferItem,\n    getFile,\n    getFileAPIOptions,\n    getDataTransferItemAPIOptions,\n    isDataTransferItemAFolder,\n    isMultiputSupported,\n} from '../../utils/uploads';\nimport DroppableContent from './DroppableContent';\nimport UploadsManager from './UploadsManager';\nimport Footer from './Footer';\nimport {\n    DEFAULT_ROOT,\n    CLIENT_NAME_CONTENT_UPLOADER,\n    DEFAULT_HOSTNAME_UPLOAD,\n    DEFAULT_HOSTNAME_API,\n    VIEW_ERROR,\n    VIEW_UPLOAD_EMPTY,\n    VIEW_UPLOAD_IN_PROGRESS,\n    VIEW_UPLOAD_SUCCESS,\n    STATUS_PENDING,\n    STATUS_IN_PROGRESS,\n    STATUS_STAGED,\n    STATUS_COMPLETE,\n    STATUS_ERROR,\n    ERROR_CODE_UPLOAD_FILE_LIMIT,\n} from '../../constants';\nimport type {\n    UploadItem,\n    UploadDataTransferItemWithAPIOptions,\n    UploadFileWithAPIOptions,\n    UploadFile,\n    UploadItemAPIOptions,\n    UploadStatus,\n} from '../../common/types/upload';\nimport type { StringMap, Token, View, BoxItem } from '../../common/types/core';\nimport '../common/fonts.scss';\nimport '../common/base.scss';\n\ntype Props = {\n    apiHost: string,\n    chunked: boolean,\n    className: string,\n    clientName: string,\n    dataTransferItems: Array<DataTransferItem | UploadDataTransferItemWithAPIOptions>,\n    fileLimit: number,\n    files?: Array<UploadFileWithAPIOptions | File>,\n    isDraggingItemsToUploadsManager?: boolean,\n    isFolderUploadEnabled: boolean,\n    isLarge: boolean,\n    isResumableUploadsEnabled: boolean,\n    isSmall: boolean,\n    isTouch: boolean,\n    isUploadFallbackLogicEnabled: boolean,\n    language?: string,\n    measureRef: Function,\n    messages?: StringMap,\n    onBeforeUpload: (file: Array<UploadFileWithAPIOptions | File>) => void,\n    onCancel: Function,\n    onClickCancel: UploadItem => void,\n    onClickResume: UploadItem => void,\n    onClickRetry: UploadItem => void,\n    onClose: Function,\n    onComplete: Function,\n    onError: Function,\n    onMinimize?: Function,\n    onProgress: Function,\n    onResume: Function,\n    onUpload: Function,\n    overwrite: boolean,\n    requestInterceptor?: Function,\n    responseInterceptor?: Function,\n    rootFolderId: string,\n    sharedLink?: string,\n    sharedLinkPassword?: string,\n    token?: Token,\n    uploadHost: string,\n    useUploadsManager?: boolean,\n};\n\ntype State = {\n    errorCode?: string,\n    isUploadsManagerExpanded: boolean,\n    itemIds: Object,\n    items: UploadItem[],\n    view: View,\n};\n\nconst CHUNKED_UPLOAD_MIN_SIZE_BYTES = 104857600; // 100MB\nconst FILE_LIMIT_DEFAULT = 100; // Upload at most 100 files at once by default\nconst HIDE_UPLOAD_MANAGER_DELAY_MS_DEFAULT = 8000;\nconst EXPAND_UPLOADS_MANAGER_ITEMS_NUM_THRESHOLD = 5;\nconst UPLOAD_CONCURRENCY = 6;\n\nclass ContentUploader extends Component<Props, State> {\n    id: string;\n\n    state: State;\n\n    props: Props;\n\n    rootElement: HTMLElement;\n\n    appElement: HTMLElement;\n\n    resetItemsTimeout: TimeoutID;\n\n    isAutoExpanded: boolean = false;\n\n    static defaultProps = {\n        rootFolderId: DEFAULT_ROOT,\n        apiHost: DEFAULT_HOSTNAME_API,\n        chunked: true,\n        className: '',\n        clientName: CLIENT_NAME_CONTENT_UPLOADER,\n        fileLimit: FILE_LIMIT_DEFAULT,\n        uploadHost: DEFAULT_HOSTNAME_UPLOAD,\n        onBeforeUpload: noop,\n        onClickCancel: noop,\n        onClickResume: noop,\n        onClickRetry: noop,\n        onClose: noop,\n        onComplete: noop,\n        onError: noop,\n        onResume: noop,\n        onUpload: noop,\n        onProgress: noop,\n        overwrite: true,\n        useUploadsManager: false,\n        files: [],\n        onMinimize: noop,\n        onCancel: noop,\n        isFolderUploadEnabled: false,\n        isResumableUploadsEnabled: false,\n        isUploadFallbackLogicEnabled: false,\n        dataTransferItems: [],\n        isDraggingItemsToUploadsManager: false,\n    };\n\n    /**\n     * [constructor]\n     *\n     * @return {ContentUploader}\n     */\n    constructor(props: Props) {\n        super(props);\n\n        const { rootFolderId, token, useUploadsManager } = props;\n        this.state = {\n            view: (rootFolderId && token) || useUploadsManager ? VIEW_UPLOAD_EMPTY : VIEW_ERROR,\n            items: [],\n            errorCode: '',\n            itemIds: {},\n            isUploadsManagerExpanded: false,\n        };\n        this.id = uniqueid('bcu_');\n    }\n\n    /**\n     * Fetches the root folder on load\n     *\n     * @private\n     * @inheritdoc\n     * @return {void}\n     */\n    componentDidMount() {\n        this.rootElement = ((document.getElementById(this.id): any): HTMLElement);\n        this.appElement = this.rootElement;\n    }\n\n    /**\n     * Cancels pending uploads\n     *\n     * @private\n     * @inheritdoc\n     * @return {void}\n     */\n    componentWillUnmount() {\n        this.cancel();\n    }\n\n    /**\n     * Adds new items to the queue when files prop gets updated in window view\n     *\n     * @return {void}\n     */\n    componentDidUpdate(): void {\n        const { files, dataTransferItems, useUploadsManager } = this.props;\n\n        const hasFiles = Array.isArray(files) && files.length > 0;\n        const hasItems = Array.isArray(dataTransferItems) && dataTransferItems.length > 0;\n        const hasUploads = hasFiles || hasItems;\n\n        if (!useUploadsManager || !hasUploads) {\n            return;\n        }\n\n        this.addFilesWithOptionsToUploadQueueAndStartUpload(files, dataTransferItems);\n    }\n\n    /**\n     * Create and return new instance of API creator\n     *\n     * @param {UploadItemAPIOptions} [uploadAPIOptions]\n     * @return {API}\n     */\n    createAPIFactory(uploadAPIOptions?: UploadItemAPIOptions): API {\n        const { rootFolderId } = this.props;\n        const folderId = getProp(uploadAPIOptions, 'folderId') || rootFolderId;\n        const fileId = getProp(uploadAPIOptions, 'fileId');\n        const itemFolderId = getTypedFolderId(folderId);\n        const itemFileId = fileId ? getTypedFileId(fileId) : null;\n\n        return new API({\n            ...this.getBaseAPIOptions(),\n            id: itemFileId || itemFolderId,\n            ...uploadAPIOptions,\n        });\n    }\n\n    /**\n     * Return base API options from props\n     *\n     * @private\n     * @returns {Object}\n     */\n    getBaseAPIOptions = (): Object => {\n        const {\n            token,\n            sharedLink,\n            sharedLinkPassword,\n            apiHost,\n            uploadHost,\n            clientName,\n            requestInterceptor,\n            responseInterceptor,\n        } = this.props;\n\n        return {\n            token,\n            sharedLink,\n            sharedLinkPassword,\n            apiHost,\n            uploadHost,\n            clientName,\n            requestInterceptor,\n            responseInterceptor,\n        };\n    };\n\n    /**\n     * Given an array of files, return the files that are new to the Content Uploader\n     *\n     * @param {Array<UploadFileWithAPIOptions | File>} files\n     */\n    getNewFiles = (files: Array<UploadFileWithAPIOptions | File>): Array<UploadFileWithAPIOptions | File> => {\n        const { rootFolderId } = this.props;\n        const { itemIds } = this.state;\n\n        return Array.from(files).filter(file => !itemIds[getFileId(file, rootFolderId)]);\n    };\n\n    /**\n     * Given an array of files, return the files that are new to the Content Uploader\n     *\n     * @param {Array<UploadFileWithAPIOptions | File>} files\n     */\n    getNewDataTransferItems = (\n        items: Array<DataTransferItem | UploadDataTransferItemWithAPIOptions>,\n    ): Array<DataTransferItem | UploadDataTransferItemWithAPIOptions> => {\n        const { rootFolderId } = this.props;\n        const { itemIds } = this.state;\n\n        return Array.from(items).filter(item => !itemIds[getDataTransferItemId(item, rootFolderId)]);\n    };\n\n    /**\n     * Converts File API to upload items and adds to upload queue.\n     *\n     * @private\n     * @param {Array<UploadFileWithAPIOptions | UploadFile>} files - Files to be added to upload queue\n     * @param {Function} itemUpdateCallback - function to be invoked after items status are updated\n     * @param {boolean} [isRelativePathIgnored] - if true webkitRelativePath property is ignored\n     * @return {void}\n     */\n    addFilesToUploadQueue = (\n        files?: Array<UploadFileWithAPIOptions | UploadFile>,\n        itemUpdateCallback: Function,\n        isRelativePathIgnored?: boolean = false,\n    ) => {\n        const { onBeforeUpload, rootFolderId } = this.props;\n        if (!files || files.length === 0) {\n            return;\n        }\n\n        const newFiles = this.getNewFiles(files);\n\n        if (newFiles.length === 0) {\n            return;\n        }\n\n        const newItemIds = {};\n\n        newFiles.forEach(file => {\n            newItemIds[getFileId(file, rootFolderId)] = true;\n        });\n\n        clearTimeout(this.resetItemsTimeout);\n\n        const firstFile = getFile(newFiles[0]);\n\n        this.setState(\n            state => ({\n                itemIds: {\n                    ...state.itemIds,\n                    ...newItemIds,\n                },\n            }),\n            () => {\n                onBeforeUpload(newFiles);\n                if (firstFile.webkitRelativePath && !isRelativePathIgnored) {\n                    // webkitRelativePath should be ignored when the upload destination folder is known\n                    this.addFilesWithRelativePathToQueue(newFiles, itemUpdateCallback);\n                } else {\n                    this.addFilesWithoutRelativePathToQueue(newFiles, itemUpdateCallback);\n                }\n            },\n        );\n    };\n\n    /**\n     * Add dropped items to the upload queue\n     *\n     * @private\n     * @param {DataTransfer} droppedItems\n     * @param {Function} itemUpdateCallback\n     * @returns {Promise<any>}\n     */\n    addDroppedItemsToUploadQueue = (droppedItems: DataTransfer, itemUpdateCallback: Function): void => {\n        if (droppedItems.items) {\n            this.addDataTransferItemsToUploadQueue(droppedItems.items, itemUpdateCallback);\n        } else {\n            Array.from(droppedItems.files).forEach(file => {\n                this.addFilesToUploadQueue([file], itemUpdateCallback);\n            });\n        }\n    };\n\n    /**\n     * Add dataTransferItems to the upload queue\n     *\n     * @private\n     * @param {DataTransferItemList} dataTransferItems\n     * @param {Function} itemUpdateCallback\n     * @returns {Promise<any>}\n     */\n    addDataTransferItemsToUploadQueue = (\n        dataTransferItems: DataTransferItemList | Array<DataTransferItem | UploadDataTransferItemWithAPIOptions>,\n        itemUpdateCallback: Function,\n    ): void => {\n        const { isFolderUploadEnabled } = this.props;\n        if (!dataTransferItems || dataTransferItems.length === 0) {\n            return;\n        }\n\n        const folderItems = [];\n        const fileItems = [];\n\n        Array.from(dataTransferItems).forEach(item => {\n            const isDirectory = isDataTransferItemAFolder(item);\n            if (isDirectory && isFolderUploadEnabled) {\n                folderItems.push(item);\n            } else if (!isDirectory) {\n                fileItems.push(item);\n            }\n        });\n\n        this.addFileDataTransferItemsToUploadQueue(fileItems, itemUpdateCallback);\n        this.addFolderDataTransferItemsToUploadQueue(folderItems, itemUpdateCallback);\n    };\n\n    /**\n     * Add dataTransferItem of file type to the upload queue\n     *\n     * @private\n     * @param {Array<DataTransferItem | UploadDataTransferItemWithAPIOptions>} dataTransferItems\n     * @param {Function} itemUpdateCallback\n     * @returns {void}\n     */\n    addFileDataTransferItemsToUploadQueue = (\n        dataTransferItems: Array<DataTransferItem | UploadDataTransferItemWithAPIOptions>,\n        itemUpdateCallback: Function,\n    ): void => {\n        dataTransferItems.forEach(async item => {\n            const file = await getFileFromDataTransferItem(item);\n            if (!file) {\n                return;\n            }\n\n            this.addFilesToUploadQueue([file], itemUpdateCallback);\n        });\n    };\n\n    /**\n     * Add dataTransferItem of folder type to the upload queue\n     *\n     * @private\n     * @param {Array<DataTransferItem | UploadDataTransferItemWithAPIOptions>} dataTransferItems\n     * @param {Function} itemUpdateCallback\n     * @returns {Promise<any>}\n     */\n    addFolderDataTransferItemsToUploadQueue = async (\n        dataTransferItems: Array<DataTransferItem | UploadDataTransferItemWithAPIOptions>,\n        itemUpdateCallback: Function,\n    ): Promise<any> => {\n        const { rootFolderId } = this.props;\n        const { itemIds } = this.state;\n        if (dataTransferItems.length === 0) {\n            return;\n        }\n\n        const newItems = this.getNewDataTransferItems(dataTransferItems);\n        newItems.forEach(item => {\n            itemIds[getDataTransferItemId(item, rootFolderId)] = true;\n        });\n\n        if (newItems.length === 0) {\n            return;\n        }\n\n        const fileAPIOptions: Object = getDataTransferItemAPIOptions(newItems[0]);\n        const { folderId = rootFolderId } = fileAPIOptions;\n\n        newItems.forEach(async item => {\n            const folderUpload = this.getFolderUploadAPI(folderId);\n            await folderUpload.buildFolderTreeFromDataTransferItem(item);\n            this.addFolderToUploadQueue(folderUpload, itemUpdateCallback, fileAPIOptions);\n        });\n    };\n\n    /**\n     * Converts File API to upload items and adds to upload queue for files with webkitRelativePath.\n     *\n     * @private\n     * @param {Array<UploadFileWithAPIOptions | File>} files - Files to be added to upload queue\n     * @param {Function} itemUpdateCallback - function to be invoked after items status are updated\n     * @return {void}\n     */\n    addFilesWithRelativePathToQueue(files: Array<UploadFileWithAPIOptions | File>, itemUpdateCallback: Function) {\n        if (files.length === 0) {\n            return;\n        }\n\n        const { rootFolderId } = this.props;\n        const fileAPIOptions: Object = getFileAPIOptions(files[0]);\n        const { folderId = rootFolderId } = fileAPIOptions;\n        const folderUpload = this.getFolderUploadAPI(folderId);\n\n        // Only 1 folder tree can be built with files having webkitRelativePath properties\n        folderUpload.buildFolderTreeFromWebkitRelativePath(files);\n\n        this.addFolderToUploadQueue(folderUpload, itemUpdateCallback, fileAPIOptions);\n    }\n\n    /**\n     * Get folder upload API instance\n     *\n     * @private\n     * @param {string} folderId\n     * @return {FolderUpload}\n     */\n    getFolderUploadAPI = (folderId: string): FolderUpload => {\n        const uploadBaseAPIOptions = this.getBaseAPIOptions();\n\n        return new FolderUpload(this.addFilesToUploadQueue, folderId, this.addToQueue, uploadBaseAPIOptions);\n    };\n\n    /**\n     * Add folder to upload queue\n     *\n     * @private\n     * @param {FolderUpload} folderUpload\n     * @param {Function} itemUpdateCallback\n     * @param {Object} apiOptions\n     * @return {void}\n     */\n    addFolderToUploadQueue = (folderUpload: FolderUpload, itemUpdateCallback: Function, apiOptions: Object): void => {\n        this.addToQueue(\n            [\n                // $FlowFixMe no file property\n                {\n                    api: folderUpload,\n                    extension: '',\n                    isFolder: true,\n                    name: folderUpload.folder.name,\n                    options: apiOptions,\n                    progress: 0,\n                    size: 1,\n                    status: STATUS_PENDING,\n                },\n            ],\n            itemUpdateCallback,\n        );\n    };\n\n    /**\n     * Converts File API to upload items and adds to upload queue for files with webkitRelativePath missing or ignored.\n     *\n     * @private\n     * @param {Array<UploadFileWithAPIOptions | File>} files - Files to be added to upload queue\n     * @param {Function} itemUpdateCallback - function to be invoked after items status are updated\n     * @return {void}\n     */\n    addFilesWithoutRelativePathToQueue = (\n        files: Array<UploadFileWithAPIOptions | File>,\n        itemUpdateCallback: Function,\n    ) => {\n        const { itemIds } = this.state;\n        const { rootFolderId } = this.props;\n\n        // Convert files from the file API to upload items\n        const newItems = files.map(file => {\n            const uploadFile = getFile(file);\n            const uploadAPIOptions = getFileAPIOptions(file);\n            const { name, size } = uploadFile;\n\n            // Extract extension or use empty string if file has no extension\n            let extension = name.substr(name.lastIndexOf('.') + 1);\n            if (extension.length === name.length) {\n                extension = '';\n            }\n\n            const api = this.getUploadAPI(uploadFile, uploadAPIOptions);\n            const uploadItem: Object = {\n                api,\n                extension,\n                file: uploadFile,\n                name,\n                progress: 0,\n                size,\n                status: STATUS_PENDING,\n            };\n\n            if (uploadAPIOptions) {\n                uploadItem.options = uploadAPIOptions;\n            }\n\n            itemIds[getFileId(uploadItem, rootFolderId)] = true;\n\n            return uploadItem;\n        });\n\n        if (newItems.length === 0) {\n            return;\n        }\n\n        this.setState({\n            itemIds,\n        });\n        this.addToQueue(newItems, itemUpdateCallback);\n    };\n\n    /**\n     * Add new items to the upload queue\n     *\n     * @private\n     * @param {Array<UploadFileWithAPIOptions | File>} newItems - Files to be added to upload queue\n     * @param {Function} itemUpdateCallback - function to be invoked after items status are updated\n     * @return {void}\n     */\n    addToQueue = (newItems: UploadItem[], itemUpdateCallback: Function) => {\n        const { fileLimit, useUploadsManager } = this.props;\n        const { items, isUploadsManagerExpanded } = this.state;\n\n        let updatedItems = [];\n        const prevItemsNum = items.length;\n        const totalNumOfItems = prevItemsNum + newItems.length;\n\n        // Don't add more than fileLimit # of items\n        if (totalNumOfItems > fileLimit) {\n            updatedItems = items.concat(newItems.slice(0, fileLimit - items.length));\n            this.setState({\n                errorCode: ERROR_CODE_UPLOAD_FILE_LIMIT,\n            });\n        } else {\n            updatedItems = items.concat(newItems);\n            this.setState({ errorCode: '' });\n\n            // If the number of items being uploaded passes the threshold, expand the upload manager\n            if (\n                prevItemsNum < EXPAND_UPLOADS_MANAGER_ITEMS_NUM_THRESHOLD &&\n                totalNumOfItems >= EXPAND_UPLOADS_MANAGER_ITEMS_NUM_THRESHOLD &&\n                useUploadsManager &&\n                !isUploadsManagerExpanded\n            ) {\n                this.isAutoExpanded = true;\n                this.expandUploadsManager();\n            }\n        }\n\n        this.updateViewAndCollection(updatedItems, () => {\n            if (itemUpdateCallback) {\n                itemUpdateCallback();\n            }\n\n            const { view } = this.state;\n            // Automatically start upload if other files are being uploaded\n            if (view === VIEW_UPLOAD_IN_PROGRESS) {\n                this.upload();\n            }\n        });\n    };\n\n    /**\n     * Returns a new API instance for the given file.\n     *\n     * @private\n     * @param {File} file - File to get a new API instance for\n     * @param {UploadItemAPIOptions} [uploadAPIOptions]\n     * @return {UploadAPI} - Instance of Upload API\n     */\n    getUploadAPI(file: File, uploadAPIOptions?: UploadItemAPIOptions) {\n        const { chunked, isResumableUploadsEnabled, isUploadFallbackLogicEnabled } = this.props;\n        const { size } = file;\n        const factory = this.createAPIFactory(uploadAPIOptions);\n\n        if (chunked && size > CHUNKED_UPLOAD_MIN_SIZE_BYTES) {\n            if (isMultiputSupported()) {\n                const chunkedUploadAPI = factory.getChunkedUploadAPI();\n                if (isResumableUploadsEnabled) {\n                    chunkedUploadAPI.isResumableUploadsEnabled = true;\n                }\n                if (isUploadFallbackLogicEnabled) {\n                    chunkedUploadAPI.isUploadFallbackLogicEnabled = true;\n                }\n                return chunkedUploadAPI;\n            }\n\n            /* eslint-disable no-console */\n            console.warn(\n                'Chunked uploading is enabled, but not supported by your browser. You may need to enable HTTPS.',\n            );\n            /* eslint-enable no-console */\n        }\n\n        const plainUploadAPI = factory.getPlainUploadAPI();\n        if (isUploadFallbackLogicEnabled) {\n            plainUploadAPI.isUploadFallbackLogicEnabled = true;\n        }\n\n        return plainUploadAPI;\n    }\n\n    /**\n     * Removes an item from the upload queue. Cancels upload if in progress.\n     *\n     * @param {UploadItem} item - Item to remove\n     * @return {void}\n     */\n    removeFileFromUploadQueue = (item: UploadItem) => {\n        const { onCancel, useUploadsManager } = this.props;\n        const { items } = this.state;\n        // Clear any error errorCode in footer\n        this.setState({ errorCode: '' });\n\n        const { api } = item;\n        api.cancel();\n\n        items.splice(items.indexOf(item), 1);\n\n        onCancel([item]);\n        this.updateViewAndCollection(items, () => {\n            // Minimize uploads manager if there are no more items\n            if (useUploadsManager && !items.length) {\n                this.minimizeUploadsManager();\n            }\n\n            const { view } = this.state;\n            if (view === VIEW_UPLOAD_IN_PROGRESS) {\n                this.upload();\n            }\n        });\n    };\n\n    /**\n     * Aborts uploads in progress and clears upload list.\n     *\n     * @private\n     * @return {void}\n     */\n    cancel = () => {\n        const { items } = this.state;\n        items.forEach(uploadItem => {\n            const { api, status } = uploadItem;\n            if (status === STATUS_IN_PROGRESS) {\n                api.cancel();\n            }\n        });\n\n        // Reset upload collection\n        this.updateViewAndCollection([]);\n    };\n\n    /**\n     * Uploads all items in the upload collection.\n     *\n     * @private\n     * @return {void}\n     */\n    upload = () => {\n        const { items } = this.state;\n        items.forEach(uploadItem => {\n            if (uploadItem.status === STATUS_PENDING) {\n                this.uploadFile(uploadItem);\n            }\n        });\n    };\n\n    /**\n     * Helper to upload a single file.\n     *\n     * @param {UploadItem} item - Upload item object\n     * @return {void}\n     */\n    uploadFile(item: UploadItem) {\n        const { overwrite, rootFolderId } = this.props;\n        const { api, file, options } = item;\n        const { items } = this.state;\n\n        const numItemsUploading = items.filter(item_t => item_t.status === STATUS_IN_PROGRESS).length;\n\n        if (numItemsUploading >= UPLOAD_CONCURRENCY) {\n            return;\n        }\n\n        const uploadOptions: Object = {\n            file,\n            folderId: options && options.folderId ? options.folderId : rootFolderId,\n            errorCallback: error => this.handleUploadError(item, error),\n            progressCallback: event => this.handleUploadProgress(item, event),\n            successCallback: entries => this.handleUploadSuccess(item, entries),\n            overwrite,\n            fileId: options && options.fileId ? options.fileId : null,\n        };\n\n        item.status = STATUS_IN_PROGRESS;\n        items[items.indexOf(item)] = item;\n\n        api.upload(uploadOptions);\n\n        this.updateViewAndCollection(items);\n    }\n\n    /**\n     * Helper to resume uploading a single file.\n     *\n     * @param {UploadItem} item - Upload item object\n     * @return {void}\n     */\n    resumeFile(item: UploadItem) {\n        const { overwrite, rootFolderId, onResume } = this.props;\n        const { api, file, options } = item;\n        const { items } = this.state;\n\n        const numItemsUploading = items.filter(item_t => item_t.status === STATUS_IN_PROGRESS).length;\n\n        if (numItemsUploading >= UPLOAD_CONCURRENCY) {\n            return;\n        }\n\n        const resumeOptions: Object = {\n            file,\n            folderId: options && options.folderId ? options.folderId : rootFolderId,\n            errorCallback: error => this.handleUploadError(item, error),\n            progressCallback: event => this.handleUploadProgress(item, event),\n            successCallback: entries => this.handleUploadSuccess(item, entries),\n            overwrite,\n            sessionId: api && api.sessionId ? api.sessionId : null,\n            fileId: options && options.fileId ? options.fileId : null,\n        };\n\n        item.status = STATUS_IN_PROGRESS;\n        delete item.error;\n        items[items.indexOf(item)] = item;\n\n        onResume(item);\n        api.resume(resumeOptions);\n\n        this.updateViewAndCollection(items);\n    }\n\n    /**\n     * Helper to reset a file. Cancels any current upload and resets progress.\n     *\n     * @param {UploadItem} item - Upload item to reset\n     * @return {void}\n     */\n    resetFile(item: UploadItem) {\n        const { api, file, options } = item;\n        if (api && typeof api.cancel === 'function') {\n            api.cancel();\n        }\n\n        // Reset API, progress & status\n        item.api = this.getUploadAPI(file, options);\n        item.progress = 0;\n        item.status = STATUS_PENDING;\n        delete item.error;\n\n        const { items } = this.state;\n        items[items.indexOf(item)] = item;\n\n        this.updateViewAndCollection(items);\n    }\n\n    /**\n     * Handles a successful upload.\n     *\n     * @private\n     * @param {UploadItem} item - Upload item corresponding to success event\n     * @param {BoxItem[]} entries - Successfully uploaded Box File objects\n     * @return {void}\n     */\n    handleUploadSuccess = (item: UploadItem, entries?: BoxItem[]) => {\n        const { onUpload, useUploadsManager } = this.props;\n\n        item.progress = 100;\n        if (!item.error) {\n            item.status = STATUS_COMPLETE;\n        }\n\n        // Cache Box File object of successfully uploaded item\n        if (entries && entries.length === 1) {\n            const [boxFile] = entries;\n            item.boxFile = boxFile;\n        }\n\n        const { items } = this.state;\n        items[items.indexOf(item)] = item;\n\n        // Broadcast that a file has been uploaded\n        if (useUploadsManager) {\n            onUpload(item);\n            this.checkClearUploadItems();\n        } else {\n            onUpload(item.boxFile);\n        }\n\n        this.updateViewAndCollection(items, () => {\n            const { view } = this.state;\n            if (view === VIEW_UPLOAD_IN_PROGRESS) {\n                this.upload();\n            }\n        });\n    };\n\n    resetUploadManagerExpandState = () => {\n        this.isAutoExpanded = false;\n        this.setState({\n            isUploadsManagerExpanded: false,\n        });\n    };\n\n    /**\n     * Updates view and internal upload collection with provided items.\n     *\n     * @private\n     * @param {UploadItem[]} item - Items to update collection with\n     * @param {Function} callback\n     * @return {void}\n     */\n    updateViewAndCollection(items: UploadItem[], callback?: Function) {\n        const { onComplete, useUploadsManager, isResumableUploadsEnabled }: Props = this.props;\n        const someUploadIsInProgress = items.some(uploadItem => uploadItem.status !== STATUS_COMPLETE);\n        const someUploadHasFailed = items.some(uploadItem => uploadItem.status === STATUS_ERROR);\n        const allItemsArePending = !items.some(uploadItem => uploadItem.status !== STATUS_PENDING);\n        const noFileIsPendingOrInProgress = items.every(\n            uploadItem => uploadItem.status !== STATUS_PENDING && uploadItem.status !== STATUS_IN_PROGRESS,\n        );\n        const areAllItemsFinished = items.every(\n            uploadItem => uploadItem.status === STATUS_COMPLETE || uploadItem.status === STATUS_ERROR,\n        );\n        const uploadItemsStatus = isResumableUploadsEnabled ? areAllItemsFinished : noFileIsPendingOrInProgress;\n\n        let view = '';\n        if ((items && items.length === 0) || allItemsArePending) {\n            view = VIEW_UPLOAD_EMPTY;\n        } else if (someUploadHasFailed && useUploadsManager) {\n            view = VIEW_ERROR;\n        } else if (someUploadIsInProgress) {\n            view = VIEW_UPLOAD_IN_PROGRESS;\n        } else {\n            view = VIEW_UPLOAD_SUCCESS;\n\n            if (!useUploadsManager) {\n                onComplete(cloneDeep(items.map(item => item.boxFile)));\n                // Reset item collection after successful upload\n                items = [];\n            }\n        }\n\n        if (uploadItemsStatus && useUploadsManager) {\n            if (this.isAutoExpanded) {\n                this.resetUploadManagerExpandState();\n            } // Else manually expanded so don't close\n            onComplete(items);\n        }\n\n        const state: Object = {\n            items,\n            view,\n        };\n\n        if (items.length === 0) {\n            state.itemIds = {};\n            state.errorCode = '';\n        }\n\n        this.setState(state, callback);\n    }\n\n    /**\n     * Handles an upload error.\n     *\n     * @private\n     * @param {UploadItem} item - Upload item corresponding to error\n     * @param {Error} error - Upload error\n     * @return {void}\n     */\n    handleUploadError = (item: UploadItem, error: Error) => {\n        const { onError, useUploadsManager } = this.props;\n        const { file } = item;\n        const { items } = this.state;\n\n        item.status = STATUS_ERROR;\n        item.error = error;\n\n        const newItems = [...items];\n        const index = newItems.findIndex(singleItem => singleItem === item);\n        if (index !== -1) {\n            newItems[index] = item;\n        }\n\n        // Broadcast that there was an error uploading a file\n        const errorData = useUploadsManager\n            ? {\n                  item,\n                  error,\n              }\n            : {\n                  file,\n                  error,\n              };\n\n        onError(errorData);\n\n        this.updateViewAndCollection(newItems, () => {\n            if (useUploadsManager) {\n                this.isAutoExpanded = true;\n                this.expandUploadsManager();\n            }\n            const { view } = this.state;\n            if (view === VIEW_UPLOAD_IN_PROGRESS) {\n                this.upload();\n            }\n        });\n    };\n\n    /**\n     * Handles an upload progress event.\n     *\n     * @private\n     * @param {UploadItem} item - Upload item corresponding to progress event\n     * @param {ProgressEvent} event - Progress event\n     * @return {void}\n     */\n    handleUploadProgress = (item: UploadItem, event: any) => {\n        if (!event.total || item.status === STATUS_COMPLETE || item.status === STATUS_STAGED) {\n            return;\n        }\n\n        item.progress = Math.min(Math.round((event.loaded / event.total) * 100), 100);\n        item.status = item.progress === 100 ? STATUS_STAGED : STATUS_IN_PROGRESS;\n\n        const { onProgress } = this.props;\n        onProgress(item);\n\n        const { items } = this.state;\n        items[items.indexOf(item)] = item;\n\n        this.updateViewAndCollection(items);\n    };\n\n    /**\n     * Updates item based on its status.\n     *\n     * @private\n     * @param {UploadItem} item - The upload item to update\n     * @return {void}\n     */\n    onClick = (item: UploadItem) => {\n        const { chunked, isResumableUploadsEnabled, onClickCancel, onClickResume, onClickRetry } = this.props;\n        const { status, file } = item;\n        const isChunkedUpload =\n            chunked && !item.isFolder && file.size > CHUNKED_UPLOAD_MIN_SIZE_BYTES && isMultiputSupported();\n        const isResumable = isResumableUploadsEnabled && isChunkedUpload && item.api.sessionId;\n\n        switch (status) {\n            case STATUS_IN_PROGRESS:\n            case STATUS_STAGED:\n            case STATUS_COMPLETE:\n            case STATUS_PENDING:\n                this.removeFileFromUploadQueue(item);\n                onClickCancel(item);\n                break;\n            case STATUS_ERROR:\n                if (isResumable) {\n                    item.bytesUploadedOnLastResume = item.api.totalUploadedBytes;\n                    this.resumeFile(item);\n                    onClickResume(item);\n                } else {\n                    this.resetFile(item);\n                    this.uploadFile(item);\n                    onClickRetry(item);\n                }\n                break;\n            default:\n                break;\n        }\n    };\n\n    /**\n     * Click action button for all uploads in the Uploads Manager with the given status.\n     *\n     * @private\n     * @param {UploadStatus} - the status that items should have for their action button to be clicked\n     * @return {void}\n     */\n    clickAllWithStatus = (status?: UploadStatus) => {\n        const { items } = this.state;\n\n        items.forEach(item => {\n            if (!status || item.status === status) {\n                this.onClick(item);\n            }\n        });\n    };\n\n    /**\n     * Expands the upload manager\n     *\n     * @return {void}\n     */\n    expandUploadsManager = (): void => {\n        const { useUploadsManager } = this.props;\n\n        if (!useUploadsManager) {\n            return;\n        }\n\n        clearTimeout(this.resetItemsTimeout);\n\n        this.setState({ isUploadsManagerExpanded: true });\n    };\n\n    /**\n     * Minimizes the upload manager\n     *\n     * @return {void}\n     */\n    minimizeUploadsManager = (): void => {\n        const { useUploadsManager, onMinimize } = this.props;\n\n        if (!useUploadsManager || !onMinimize) {\n            return;\n        }\n\n        clearTimeout(this.resetItemsTimeout);\n\n        onMinimize();\n        this.resetUploadManagerExpandState();\n        this.checkClearUploadItems();\n    };\n\n    /**\n     * Checks if the upload items should be cleared after a timeout\n     *\n     * @return {void}\n     */\n    checkClearUploadItems = () => {\n        this.resetItemsTimeout = setTimeout(\n            this.resetUploadsManagerItemsWhenUploadsComplete,\n            HIDE_UPLOAD_MANAGER_DELAY_MS_DEFAULT,\n        );\n    };\n\n    /**\n     * Toggles the upload manager\n     *\n     * @return {void}\n     */\n    toggleUploadsManager = (): void => {\n        const { isUploadsManagerExpanded } = this.state;\n\n        if (isUploadsManagerExpanded) {\n            this.minimizeUploadsManager();\n        } else {\n            this.expandUploadsManager();\n        }\n    };\n\n    /**\n     * Empties the items queue\n     *\n     * @return {void}\n     */\n    resetUploadsManagerItemsWhenUploadsComplete = (): void => {\n        const { view, items, isUploadsManagerExpanded } = this.state;\n        const { useUploadsManager, onCancel } = this.props;\n\n        // Do not reset items when upload manger is expanded or there're uploads in progress\n        if ((isUploadsManagerExpanded && useUploadsManager && !!items.length) || view === VIEW_UPLOAD_IN_PROGRESS) {\n            return;\n        }\n\n        onCancel(items);\n\n        this.setState({\n            items: [],\n            itemIds: {},\n        });\n    };\n\n    /**\n     * Adds file to the upload queue and starts upload immediately\n     *\n     * @param {Array<UploadFileWithAPIOptions | File>} files - Files to be added to upload queue\n     * @return {void}\n     */\n    addFilesWithOptionsToUploadQueueAndStartUpload = (\n        files?: Array<UploadFileWithAPIOptions | File>,\n        dataTransferItems: Array<DataTransferItem | UploadDataTransferItemWithAPIOptions>,\n    ): void => {\n        this.addFilesToUploadQueue(files, this.upload);\n        this.addDataTransferItemsToUploadQueue(dataTransferItems, this.upload);\n    };\n\n    /**\n     * Renders the content uploader\n     *\n     * @inheritdoc\n     * @return {Component}\n     */\n    render() {\n        const {\n            language,\n            messages,\n            onClose,\n            className,\n            measureRef,\n            isTouch,\n            fileLimit,\n            useUploadsManager,\n            isResumableUploadsEnabled,\n            isFolderUploadEnabled,\n            isDraggingItemsToUploadsManager = false,\n        }: Props = this.props;\n        const { view, items, errorCode, isUploadsManagerExpanded }: State = this.state;\n        const isEmpty = items.length === 0;\n        const isVisible = !isEmpty || !!isDraggingItemsToUploadsManager;\n\n        const hasFiles = items.length !== 0;\n        const isLoading = items.some(item => item.status === STATUS_IN_PROGRESS);\n        const isDone = items.every(item => item.status === STATUS_COMPLETE || item.status === STATUS_STAGED);\n\n        const styleClassName = classNames('bcu', className, {\n            'be-app-element': !useUploadsManager,\n            be: !useUploadsManager,\n        });\n\n        return (\n            <Internationalize language={language} messages={messages}>\n                {useUploadsManager ? (\n                    <div ref={measureRef} className={styleClassName} id={this.id}>\n                        <UploadsManager\n                            isDragging={isDraggingItemsToUploadsManager}\n                            isExpanded={isUploadsManagerExpanded}\n                            isResumableUploadsEnabled={isResumableUploadsEnabled}\n                            isVisible={isVisible}\n                            items={items}\n                            onItemActionClick={this.onClick}\n                            onRemoveActionClick={this.removeFileFromUploadQueue}\n                            onUploadsManagerActionClick={this.clickAllWithStatus}\n                            toggleUploadsManager={this.toggleUploadsManager}\n                            view={view}\n                        />\n                    </div>\n                ) : (\n                    <div ref={measureRef} className={styleClassName} id={this.id}>\n                        <DroppableContent\n                            addDataTransferItemsToUploadQueue={this.addDroppedItemsToUploadQueue}\n                            addFiles={this.addFilesToUploadQueue}\n                            allowedTypes={['Files']}\n                            isFolderUploadEnabled={isFolderUploadEnabled}\n                            isTouch={isTouch}\n                            items={items}\n                            onClick={this.onClick}\n                            view={view}\n                        />\n                        <Footer\n                            errorCode={errorCode}\n                            fileLimit={fileLimit}\n                            hasFiles={hasFiles}\n                            isLoading={isLoading}\n                            onCancel={this.cancel}\n                            onClose={onClose}\n                            onUpload={this.upload}\n                            isDone={isDone}\n                        />\n                    </div>\n                )}\n            </Internationalize>\n        );\n    }\n}\n\nexport type ContentUploaderProps = Props;\nexport default makeResponsive(ContentUploader);\nexport { ContentUploader as ContentUploaderComponent, CHUNKED_UPLOAD_MIN_SIZE_BYTES };\n"],"file":"ContentUploader.js"}