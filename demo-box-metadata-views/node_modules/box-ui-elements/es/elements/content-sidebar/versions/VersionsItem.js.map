{"version":3,"sources":["../../../../src/elements/content-sidebar/versions/VersionsItem.js"],"names":["React","FormattedMessage","messages","selectors","sizeUtil","VersionsItemActions","VersionsItemButton","VersionsItemBadge","VersionsItemRetention","ReadableTime","FILE_REQUEST_NAME","VERSION_DELETE_ACTION","VERSION_PROMOTE_ACTION","VERSION_RESTORE_ACTION","VERSION_UPLOAD_ACTION","ACTION_MAP","versionDeletedBy","versionRestoredBy","versionPromotedBy","versionUploadedBy","FIVE_MINUTES_MS","VersionsItem","fileId","isCurrent","isSelected","isWatermarked","onDelete","onDownload","onPreview","onPromote","onRestore","version","versionCount","versionLimit","createdAt","created_at","versionId","id","is_download_available","permissions","restoredAt","restored_at","retention","size","trashedAt","trashed_at","versionNumber","version_number","versionPromoted","version_promoted","can_delete","can_download","can_preview","can_upload","retentionAppliedAt","applied_at","retentionDispositionAt","disposition_at","retentionDispositionAtDate","Date","versionAction","getVersionAction","versionInteger","parseInt","versionTime","versionTimestamp","getTime","versionUserName","getVersionUser","name","versionUserUnknown","versionDisplayName","fileRequestDisplayName","isDeleted","isDownloadable","isLimited","isRestricted","isRetained","canPreview","showDelete","showDownload","showPromote","showRestore","showPreview","hasActions","handleAction","handler","versionCurrent","versionLimitExceeded"],"mappings":"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","sourcesContent":["/**\n * @flow\n * @file Versions Item component\n * @author Box\n */\n\nimport * as React from 'react';\nimport { FormattedMessage } from 'react-intl';\nimport messages from './messages';\nimport selectors from '../../common/selectors/version';\nimport sizeUtil from '../../../utils/size';\nimport VersionsItemActions from './VersionsItemActions';\nimport VersionsItemButton from './VersionsItemButton';\nimport VersionsItemBadge from './VersionsItemBadge';\nimport VersionsItemRetention from './VersionsItemRetention';\nimport { ReadableTime } from '../../../components/time';\nimport {\n    FILE_REQUEST_NAME,\n    VERSION_DELETE_ACTION,\n    VERSION_PROMOTE_ACTION,\n    VERSION_RESTORE_ACTION,\n    VERSION_UPLOAD_ACTION,\n} from '../../../constants';\nimport type { VersionActionCallback } from './flowTypes';\nimport type { BoxItemVersion } from '../../../common/types/core';\nimport './VersionsItem.scss';\n\ntype Props = {\n    fileId: string,\n    isCurrent?: boolean,\n    isSelected?: boolean,\n    isWatermarked?: boolean,\n    onDelete?: VersionActionCallback,\n    onDownload?: VersionActionCallback,\n    onPreview?: VersionActionCallback,\n    onPromote?: VersionActionCallback,\n    onRestore?: VersionActionCallback,\n    version: BoxItemVersion,\n    versionCount: number,\n    versionLimit: number,\n};\n\nconst ACTION_MAP = {\n    [VERSION_DELETE_ACTION]: messages.versionDeletedBy,\n    [VERSION_RESTORE_ACTION]: messages.versionRestoredBy,\n    [VERSION_PROMOTE_ACTION]: messages.versionPromotedBy,\n    [VERSION_UPLOAD_ACTION]: messages.versionUploadedBy,\n};\nconst FIVE_MINUTES_MS = 5 * 60 * 1000;\n\nconst VersionsItem = ({\n    fileId,\n    isCurrent = false,\n    isSelected = false,\n    isWatermarked = false,\n    onDelete,\n    onDownload,\n    onPreview,\n    onPromote,\n    onRestore,\n    version,\n    versionCount,\n    versionLimit,\n}: Props) => {\n    const {\n        created_at: createdAt,\n        id: versionId,\n        is_download_available,\n        permissions = {},\n        restored_at: restoredAt,\n        retention,\n        size,\n        trashed_at: trashedAt,\n        version_number: versionNumber,\n        version_promoted: versionPromoted,\n    } = version;\n    const { can_delete, can_download, can_preview, can_upload } = permissions;\n    const { applied_at: retentionAppliedAt, disposition_at: retentionDispositionAt } = retention || {};\n    const retentionDispositionAtDate = retentionDispositionAt && new Date(retentionDispositionAt);\n\n    // Version info helpers\n    const versionAction = selectors.getVersionAction(version);\n    const versionInteger = versionNumber ? parseInt(versionNumber, 10) : 1;\n    const versionTime = restoredAt || trashedAt || createdAt;\n    const versionTimestamp = versionTime && new Date(versionTime).getTime();\n    const versionUserName = selectors.getVersionUser(version).name || (\n        <FormattedMessage {...messages.versionUserUnknown} />\n    );\n    const versionDisplayName =\n        versionUserName !== FILE_REQUEST_NAME ? (\n            versionUserName\n        ) : (\n            <FormattedMessage {...messages.fileRequestDisplayName} />\n        );\n    // Version state helpers\n    const isDeleted = versionAction === VERSION_DELETE_ACTION;\n    const isDownloadable = !!is_download_available;\n    const isLimited = versionCount - versionInteger >= versionLimit;\n    const isRestricted = isWatermarked && !isCurrent; // Watermarked files do not support prior version preview\n    const isRetained = !!retentionAppliedAt && (!retentionDispositionAtDate || retentionDispositionAtDate > new Date());\n\n    // Version action helpers\n    const canPreview = can_preview && !isDeleted && !isLimited && !isRestricted;\n    const showDelete = can_delete && !isDeleted && !isCurrent;\n    const showDownload = can_download && !isDeleted && isDownloadable;\n    const showPromote = can_upload && !isDeleted && !isCurrent;\n    const showRestore = can_delete && isDeleted;\n    const showPreview = canPreview && !isSelected;\n    const hasActions = showDelete || showDownload || showPreview || showPromote || showRestore;\n\n    // Version action callback helper\n    const handleAction = (handler?: VersionActionCallback) => (): void => {\n        if (handler) {\n            handler(versionId);\n        }\n    };\n\n    return (\n        <div className=\"bcs-VersionsItem\">\n            <VersionsItemButton\n                fileId={fileId}\n                isCurrent={isCurrent}\n                isDisabled={!canPreview}\n                isSelected={isSelected}\n                onClick={handleAction(onPreview)}\n            >\n                <div className=\"bcs-VersionsItem-badge\">\n                    <VersionsItemBadge versionNumber={versionNumber} />\n                </div>\n\n                <div className=\"bcs-VersionsItem-details\">\n                    {isCurrent && (\n                        <div className=\"bcs-VersionsItem-current\">\n                            <FormattedMessage {...messages.versionCurrent} />\n                        </div>\n                    )}\n\n                    <div className=\"bcs-VersionsItem-log\" data-testid=\"bcs-VersionsItem-log\" title={versionDisplayName}>\n                        <FormattedMessage\n                            {...ACTION_MAP[versionAction]}\n                            values={{ name: versionDisplayName, versionPromoted }}\n                        />\n                    </div>\n\n                    <div className=\"bcs-VersionsItem-info\">\n                        {versionTimestamp && (\n                            <time className=\"bcs-VersionsItem-date\" dateTime={versionTime}>\n                                <ReadableTime\n                                    alwaysShowTime\n                                    relativeThreshold={FIVE_MINUTES_MS}\n                                    timestamp={versionTimestamp}\n                                />\n                            </time>\n                        )}\n                        {!!size && <span className=\"bcs-VersionsItem-size\">{sizeUtil(size)}</span>}\n                    </div>\n\n                    {isRetained && (\n                        <div className=\"bcs-VersionsItem-retention\">\n                            <VersionsItemRetention retention={retention} />\n                        </div>\n                    )}\n\n                    {isLimited && hasActions && (\n                        <div className=\"bcs-VersionsItem-footer\">\n                            <FormattedMessage {...messages.versionLimitExceeded} values={{ versionLimit }} />\n                        </div>\n                    )}\n                </div>\n            </VersionsItemButton>\n\n            {!isLimited && hasActions && (\n                <VersionsItemActions\n                    fileId={fileId}\n                    isCurrent={isCurrent}\n                    isRetained={isRetained}\n                    onDelete={handleAction(onDelete)}\n                    onDownload={handleAction(onDownload)}\n                    onPreview={handleAction(onPreview)}\n                    onPromote={handleAction(onPromote)}\n                    onRestore={handleAction(onRestore)}\n                    showDelete={showDelete}\n                    showDownload={showDownload}\n                    showPreview={showPreview}\n                    showPromote={showPromote}\n                    showRestore={showRestore}\n                />\n            )}\n        </div>\n    );\n};\nexport default VersionsItem;\n"],"file":"VersionsItem.js"}