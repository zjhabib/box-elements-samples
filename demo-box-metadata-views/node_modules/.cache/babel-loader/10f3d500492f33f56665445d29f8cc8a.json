{"ast":null,"code":"function ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n  return target;\n}\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n  return obj;\n}\n\n/**\n * \n * @file Activity feed utility methods\n */\nimport selectors from '../../../common/selectors/version';\nimport { PLACEHOLDER_USER, VERSION_UPLOAD_ACTION } from '../../../../constants';\nexport var ItemTypes = {\n  fileVersion: 'file_version'\n};\nexport function collapseFeedState(feedState) {\n  if (!feedState) {\n    return [];\n  }\n  return feedState.reduce(function (collapsedFeedState, feedItem) {\n    var previousFeedItem = collapsedFeedState.pop();\n    if (!previousFeedItem) {\n      return collapsedFeedState.concat([feedItem]);\n    }\n    if (feedItem.type === ItemTypes.fileVersion && previousFeedItem.type === ItemTypes.fileVersion && selectors.getVersionAction(feedItem) === VERSION_UPLOAD_ACTION && selectors.getVersionAction(previousFeedItem) === VERSION_UPLOAD_ACTION) {\n      var tmpModifiedBy = previousFeedItem.modified_by,\n        _previousFeedItem$ver = previousFeedItem.versions,\n        versions = _previousFeedItem$ver === void 0 ? [previousFeedItem] : _previousFeedItem$ver,\n        _previousFeedItem$ver2 = previousFeedItem.version_start,\n        version_start = _previousFeedItem$ver2 === void 0 ? parseInt(previousFeedItem.version_number, 10) : _previousFeedItem$ver2,\n        _previousFeedItem$ver3 = previousFeedItem.version_end,\n        version_end = _previousFeedItem$ver3 === void 0 ? parseInt(previousFeedItem.version_number, 10) : _previousFeedItem$ver3;\n      var prevModifiedBy = tmpModifiedBy || PLACEHOLDER_USER;\n      var tmpCurModifiedBy = feedItem.modified_by,\n        created_at = feedItem.created_at,\n        trashed_at = feedItem.trashed_at,\n        id = feedItem.id,\n        version_number = feedItem.version_number;\n      var parsedVersionNumber = parseInt(version_number, 10);\n      var collaborators = previousFeedItem.collaborators || _defineProperty({}, prevModifiedBy.id, _objectSpread({}, prevModifiedBy));\n      var modifiedBy = tmpCurModifiedBy || PLACEHOLDER_USER; // add collaborators\n      // $FlowFixMe\n\n      collaborators[modifiedBy.id] = _objectSpread({}, modifiedBy);\n      return collapsedFeedState.concat([{\n        collaborators: collaborators,\n        created_at: created_at,\n        modified_by: modifiedBy,\n        trashed_at: trashed_at,\n        id: id,\n        type: ItemTypes.fileVersion,\n        version_number: version_number,\n        versions: versions.concat([feedItem]),\n        version_start: Math.min(version_start, parsedVersionNumber),\n        version_end: Math.max(version_end, parsedVersionNumber)\n      }]);\n    }\n    return collapsedFeedState.concat([previousFeedItem, feedItem]);\n  }, []);\n}","map":{"version":3,"sources":["../../../../../src/elements/content-sidebar/activity-feed/activity-feed/activityFeedUtils.js"],"names":["selectors","PLACEHOLDER_USER","VERSION_UPLOAD_ACTION","ItemTypes","fileVersion","collapseFeedState","feedState","reduce","collapsedFeedState","feedItem","previousFeedItem","pop","concat","type","getVersionAction","modified_by","tmpModifiedBy","versions","version_start","parseInt","version_number","version_end","prevModifiedBy","tmpCurModifiedBy","created_at","trashed_at","id","parsedVersionNumber","collaborators","modifiedBy","Math","min","max"],"mappings":"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","sourcesContent":["/**\n * @flow\n * @file Activity feed utility methods\n */\n\nimport selectors from '../../../common/selectors/version';\nimport { PLACEHOLDER_USER, VERSION_UPLOAD_ACTION } from '../../../../constants';\nimport type { FeedItems } from '../../../../common/types/feed';\n\nexport const ItemTypes = {\n    fileVersion: 'file_version',\n};\n\nexport function collapseFeedState(feedState: ?FeedItems): FeedItems {\n    if (!feedState) {\n        return [];\n    }\n\n    return feedState.reduce((collapsedFeedState, feedItem) => {\n        const previousFeedItem = collapsedFeedState.pop();\n\n        if (!previousFeedItem) {\n            return collapsedFeedState.concat([feedItem]);\n        }\n\n        if (\n            feedItem.type === ItemTypes.fileVersion &&\n            previousFeedItem.type === ItemTypes.fileVersion &&\n            selectors.getVersionAction(feedItem) === VERSION_UPLOAD_ACTION &&\n            selectors.getVersionAction(previousFeedItem) === VERSION_UPLOAD_ACTION\n        ) {\n            const {\n                modified_by: tmpModifiedBy,\n                versions = [previousFeedItem],\n                version_start = parseInt(previousFeedItem.version_number, 10),\n                version_end = parseInt(previousFeedItem.version_number, 10),\n            } = previousFeedItem;\n\n            const prevModifiedBy = tmpModifiedBy || PLACEHOLDER_USER;\n\n            const { modified_by: tmpCurModifiedBy, created_at, trashed_at, id, version_number } = feedItem;\n            const parsedVersionNumber = parseInt(version_number, 10);\n            const collaborators = previousFeedItem.collaborators || {\n                [prevModifiedBy.id]: { ...prevModifiedBy },\n            };\n\n            const modifiedBy = tmpCurModifiedBy || PLACEHOLDER_USER;\n\n            // add collaborators\n            // $FlowFixMe\n            collaborators[modifiedBy.id] = { ...modifiedBy };\n\n            return collapsedFeedState.concat([\n                {\n                    collaborators,\n                    created_at,\n                    modified_by: modifiedBy,\n                    trashed_at,\n                    id,\n                    type: ItemTypes.fileVersion,\n                    version_number,\n                    versions: versions.concat([feedItem]),\n                    version_start: Math.min(version_start, parsedVersionNumber),\n                    version_end: Math.max(version_end, parsedVersionNumber),\n                },\n            ]);\n        }\n\n        return collapsedFeedState.concat([previousFeedItem, feedItem]);\n    }, []);\n}\n"]},"metadata":{},"sourceType":"module"}