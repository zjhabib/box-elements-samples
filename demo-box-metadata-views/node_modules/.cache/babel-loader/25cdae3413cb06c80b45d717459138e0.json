{"ast":null,"code":"function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n  return _typeof(obj);\n}\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n    return target;\n  };\n  return _extends.apply(this, arguments);\n}\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n  return _assertThisInitialized(self);\n}\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n  return self;\n}\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n  return obj;\n}\nimport * as React from 'react';\nimport classNames from 'classnames';\nimport noop from 'lodash/noop';\nimport { FormattedMessage } from 'react-intl';\nimport TetherComponent from 'react-tether';\nimport Trash16 from '../../../../icon/line/Trash16';\nimport Pencil16 from '../../../../icon/line/Pencil16';\nimport Avatar from '../Avatar';\nimport Media from '../../../../components/media';\nimport { MenuItem } from '../../../../components/menu';\nimport { ACTIVITY_TARGETS } from '../../../common/interactionTargets';\nimport DeleteConfirmation from '../common/delete-confirmation';\nimport ActivityTimestamp from '../common/activity-timestamp';\nimport UserLink from '../common/user-link';\nimport ActivityError from '../common/activity-error';\nimport ActivityMessage from '../common/activity-message';\nimport CommentForm from '../comment-form';\nimport { PLACEHOLDER_USER } from '../../../../constants';\nimport messages from './messages';\nimport './Comment.scss';\nvar Comment = /*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(Comment, _React$Component);\n  function Comment() {\n    var _getPrototypeOf2;\n    var _this;\n    _classCallCheck(this, Comment);\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Comment)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      isConfirmingDelete: false,\n      isEditing: false,\n      isInputOpen: false\n    });\n    _defineProperty(_assertThisInitialized(_this), \"handleDeleteConfirm\", function () {\n      var _this$props = _this.props,\n        id = _this$props.id,\n        onDelete = _this$props.onDelete,\n        permissions = _this$props.permissions;\n      onDelete({\n        id: id,\n        permissions: permissions\n      });\n    });\n    _defineProperty(_assertThisInitialized(_this), \"handleDeleteCancel\", function () {\n      _this.setState({\n        isConfirmingDelete: false\n      });\n    });\n    _defineProperty(_assertThisInitialized(_this), \"handleDeleteClick\", function () {\n      _this.setState({\n        isConfirmingDelete: true\n      });\n    });\n    _defineProperty(_assertThisInitialized(_this), \"handleEditClick\", function () {\n      _this.setState({\n        isEditing: true,\n        isInputOpen: true\n      });\n    });\n    _defineProperty(_assertThisInitialized(_this), \"commentFormFocusHandler\", function () {\n      return _this.setState({\n        isInputOpen: true\n      });\n    });\n    _defineProperty(_assertThisInitialized(_this), \"commentFormCancelHandler\", function () {\n      return _this.setState({\n        isInputOpen: false,\n        isEditing: false\n      });\n    });\n    _defineProperty(_assertThisInitialized(_this), \"commentFormSubmitHandler\", function () {\n      return _this.setState({\n        isInputOpen: false,\n        isEditing: false\n      });\n    });\n    _defineProperty(_assertThisInitialized(_this), \"handleUpdate\", function (_ref) {\n      var id = _ref.id,\n        text = _ref.text,\n        hasMention = _ref.hasMention;\n      var _this$props2 = _this.props,\n        onEdit = _this$props2.onEdit,\n        permissions = _this$props2.permissions;\n      onEdit(id, text, hasMention, permissions);\n      _this.commentFormSubmitHandler();\n    });\n    return _this;\n  }\n  _createClass(Comment, [{\n    key: \"render\",\n    value: function render() {\n      var _this$props3 = this.props,\n        created_by = _this$props3.created_by,\n        created_at = _this$props3.created_at,\n        _this$props3$permissi = _this$props3.permissions,\n        permissions = _this$props3$permissi === void 0 ? {} : _this$props3$permissi,\n        id = _this$props3.id,\n        isPending = _this$props3.isPending,\n        error = _this$props3.error,\n        _this$props3$tagged_m = _this$props3.tagged_message,\n        tagged_message = _this$props3$tagged_m === void 0 ? '' : _this$props3$tagged_m,\n        translatedTaggedMessage = _this$props3.translatedTaggedMessage,\n        translations = _this$props3.translations,\n        currentUser = _this$props3.currentUser,\n        isDisabled = _this$props3.isDisabled,\n        getAvatarUrl = _this$props3.getAvatarUrl,\n        getUserProfileUrl = _this$props3.getUserProfileUrl,\n        getMentionWithQuery = _this$props3.getMentionWithQuery,\n        mentionSelectorContacts = _this$props3.mentionSelectorContacts,\n        onEdit = _this$props3.onEdit;\n      var _this$state = this.state,\n        isConfirmingDelete = _this$state.isConfirmingDelete,\n        isEditing = _this$state.isEditing,\n        isInputOpen = _this$state.isInputOpen;\n      var createdAtTimestamp = new Date(created_at).getTime();\n      var createdByUser = created_by || PLACEHOLDER_USER;\n      var canEdit = onEdit !== noop && permissions.can_edit;\n      var canDelete = permissions.can_delete;\n      var isMenuVisible = (canDelete || canEdit) && !isPending;\n      return React.createElement(\"div\", {\n        className: \"bcs-Comment\"\n      }, React.createElement(Media, {\n        className: classNames('bcs-Comment-media', {\n          'bcs-is-pending': isPending || error\n        })\n      }, React.createElement(Media.Figure, null, React.createElement(Avatar, {\n        getAvatarUrl: getAvatarUrl,\n        user: createdByUser\n      })), React.createElement(Media.Body, null, isMenuVisible && React.createElement(TetherComponent, {\n        attachment: \"top right\",\n        className: \"bcs-Comment-deleteConfirmationModal\",\n        constraints: [{\n          to: 'scrollParent',\n          attachment: 'together'\n        }],\n        targetAttachment: \"bottom right\"\n      }, React.createElement(Media.Menu, {\n        isDisabled: isConfirmingDelete,\n        \"data-testid\": \"comment-actions-menu\",\n        menuProps: {\n          'data-resin-component': ACTIVITY_TARGETS.COMMENT_OPTIONS\n        }\n      }, canEdit && React.createElement(MenuItem, {\n        \"data-resin-target\": ACTIVITY_TARGETS.COMMENT_OPTIONS_EDIT,\n        \"data-testid\": \"edit-comment\",\n        onClick: this.handleEditClick\n      }, React.createElement(Pencil16, null), React.createElement(FormattedMessage, messages.commentEditMenuItem)), canDelete && React.createElement(MenuItem, {\n        \"data-resin-target\": ACTIVITY_TARGETS.COMMENT_OPTIONS_DELETE,\n        \"data-testid\": \"delete-comment\",\n        onClick: this.handleDeleteClick\n      }, React.createElement(Trash16, null), React.createElement(FormattedMessage, messages.commentDeleteMenuItem))), isConfirmingDelete && React.createElement(DeleteConfirmation, {\n        \"data-resin-component\": ACTIVITY_TARGETS.COMMENT_OPTIONS,\n        isOpen: isConfirmingDelete,\n        message: messages.commentDeletePrompt,\n        onDeleteCancel: this.handleDeleteCancel,\n        onDeleteConfirm: this.handleDeleteConfirm\n      })), React.createElement(\"div\", {\n        className: \"bcs-Comment-headline\"\n      }, React.createElement(UserLink, {\n        \"data-resin-target\": ACTIVITY_TARGETS.PROFILE,\n        id: createdByUser.id,\n        name: createdByUser.name,\n        getUserProfileUrl: getUserProfileUrl\n      })), React.createElement(\"div\", null, React.createElement(ActivityTimestamp, {\n        date: createdAtTimestamp\n      })), isEditing ? React.createElement(CommentForm, {\n        isDisabled: isDisabled,\n        className: classNames('bcs-Comment-editor', {\n          'bcs-is-disabled': isDisabled\n        }),\n        updateComment: this.handleUpdate,\n        isOpen: isInputOpen // $FlowFixMe\n        ,\n\n        user: currentUser,\n        onCancel: this.commentFormCancelHandler,\n        onFocus: this.commentFormFocusHandler,\n        isEditing: isEditing,\n        entityId: id,\n        tagged_message: tagged_message,\n        getAvatarUrl: getAvatarUrl,\n        mentionSelectorContacts: mentionSelectorContacts,\n        getMentionWithQuery: getMentionWithQuery\n      }) : React.createElement(ActivityMessage, _extends({\n        id: id,\n        tagged_message: tagged_message,\n        translatedTaggedMessage: translatedTaggedMessage\n      }, translations, {\n        translationFailed: error ? true : null,\n        getUserProfileUrl: getUserProfileUrl\n      })))), error ? React.createElement(ActivityError, error) : null);\n    }\n  }]);\n  return Comment;\n}(React.Component);\n_defineProperty(Comment, \"defaultProps\", {\n  onDelete: noop,\n  onEdit: noop\n});\nexport default Comment;","map":{"version":3,"sources":["../../../../../src/elements/content-sidebar/activity-feed/comment/Comment.js"],"names":["React","classNames","noop","FormattedMessage","TetherComponent","Trash16","Pencil16","Avatar","Media","MenuItem","ACTIVITY_TARGETS","DeleteConfirmation","ActivityTimestamp","UserLink","ActivityError","ActivityMessage","CommentForm","PLACEHOLDER_USER","messages","Comment","Component","onDelete","onEdit","isConfirmingDelete","isEditing","isInputOpen","id","permissions","props","setState","text","hasMention","commentFormSubmitHandler","created_by","created_at","isPending","error","tagged_message","translatedTaggedMessage","translations","currentUser","isDisabled","getAvatarUrl","getUserProfileUrl","getMentionWithQuery","mentionSelectorContacts","state","createdAtTimestamp","Date","getTime","createdByUser","canEdit","can_edit","canDelete","can_delete","isMenuVisible","to","attachment","COMMENT_OPTIONS","COMMENT_OPTIONS_EDIT","handleEditClick","commentEditMenuItem","COMMENT_OPTIONS_DELETE","handleDeleteClick","commentDeleteMenuItem","commentDeletePrompt","handleDeleteCancel","handleDeleteConfirm","PROFILE","name","handleUpdate","commentFormCancelHandler","commentFormFocusHandler"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;AACA,OAAOC,UAAP,MAAuB,YAAvB;AACA,OAAOC,IAAP,MAAiB,aAAjB;AACA,SAASC,gBAAT,QAAiC,YAAjC;AACA,OAAOC,eAAP,MAA4B,cAA5B;AACA,OAAOC,OAAP,MAAoB,+BAApB;AACA,OAAOC,QAAP,MAAqB,gCAArB;AACA,OAAOC,MAAP,MAAmB,WAAnB;AACA,OAAOC,KAAP,MAAkB,8BAAlB;AACA,SAASC,QAAT,QAAyB,6BAAzB;AACA,SAASC,gBAAT,QAAiC,oCAAjC;AACA,OAAOC,kBAAP,MAA+B,+BAA/B;AACA,OAAOC,iBAAP,MAA8B,8BAA9B;AACA,OAAOC,QAAP,MAAqB,qBAArB;AACA,OAAOC,aAAP,MAA0B,0BAA1B;AACA,OAAOC,eAAP,MAA4B,4BAA5B;AACA,OAAOC,WAAP,MAAwB,iBAAxB;AACA,SAASC,gBAAT,QAAiC,uBAAjC;AACA,OAAOC,QAAP,MAAqB,YAArB;AAKA,OAAO,gBAAP;IA6BMC,O;;;;;;;;;;;4DAMM;MACJI,kBAAkB,EAAE,KADhB;MAEJC,SAAS,EAAE,KAFP;MAGJC,WAAW,EAAE;IAHT,C;0EAMc,YAAY;MAAA,IAAA,WAAA,GACQ,KAAA,CAAKG,KADb;QACtBF,EADsB,GAAA,WAAA,CACtBA,EADsB;QAClBL,QADkB,GAAA,WAAA,CAClBA,QADkB;QACRM,WADQ,GAAA,WAAA,CACRA,WADQ;MAE9BN,QAAQ,CAAC;QAAEK,EAAE,EAAFA,EAAF;QAAMC,WAAW,EAAXA;MAAN,CAAD,CAARN;IACH,C;yEAEoB,YAAY;MAC7B,KAAA,CAAKQ,QAAL,CAAc;QAAEN,kBAAkB,EAAE;MAAtB,CAAd,CAAA;IACH,C;wEAEmB,YAAM;MACtB,KAAA,CAAKM,QAAL,CAAc;QAAEN,kBAAkB,EAAE;MAAtB,CAAd,CAAA;IACH,C;sEAEiB,YAAY;MAC1B,KAAA,CAAKM,QAAL,CAAc;QAAEL,SAAS,EAAE,IAAb;QAAmBC,WAAW,EAAE;MAAhC,CAAd,CAAA;IACH,C;8EAEyB,YAAA;MAAA,OAAY,KAAA,CAAKI,QAAL,CAAc;QAAEJ,WAAW,EAAE;MAAf,CAAd,CAAZ;IAAA,C;+EAEC,YAAA;MAAA,OAAY,KAAA,CAAKI,QAAL,CAAc;QAAEJ,WAAW,EAAE,KAAf;QAAsBD,SAAS,EAAE;MAAjC,CAAd,CAAZ;IAAA,C;+EAEA,YAAA;MAAA,OAAY,KAAA,CAAKK,QAAL,CAAc;QAAEJ,WAAW,EAAE,KAAf;QAAsBD,SAAS,EAAE;MAAjC,CAAd,CAAZ;IAAA,C;mEAEZ,UAAA,IAAA,EAAuF;MAAA,IAApFE,EAAoF,GAAA,IAAA,CAApFA,EAAoF;QAAhFI,IAAgF,GAAA,IAAA,CAAhFA,IAAgF;QAA1EC,UAA0E,GAAA,IAAA,CAA1EA,UAA0E;MAAA,IAAA,YAAA,GAClE,KAAA,CAAKH,KAD6D;QAC1FN,MAD0F,GAAA,YAAA,CAC1FA,MAD0F;QAClFK,WADkF,GAAA,YAAA,CAClFA,WADkF;MAElGL,MAAM,CAACI,EAAD,EAAKI,IAAL,EAAWC,UAAX,EAAuBJ,WAAvB,CAANL;MACA,KAAA,CAAKU,wBAAL,CAAA,CAAA;IACH,C;;;;;6BAEoB;MAAA,IAAA,YAAA,GAkBb,IAAA,CAAKJ,KAlBQ;QAEbK,UAFa,GAAA,YAAA,CAEbA,UAFa;QAGbC,UAHa,GAAA,YAAA,CAGbA,UAHa;QAAA,qBAAA,GAAA,YAAA,CAIbP,WAJa;QAIbA,WAJa,GAAA,qBAAA,KAAA,KAAA,CAAA,GAIC,CAAA,CAJD,GAAA,qBAAA;QAKbD,EALa,GAAA,YAAA,CAKbA,EALa;QAMbS,SANa,GAAA,YAAA,CAMbA,SANa;QAObC,KAPa,GAAA,YAAA,CAObA,KAPa;QAAA,qBAAA,GAAA,YAAA,CAQbC,cARa;QAQbA,cARa,GAAA,qBAAA,KAAA,KAAA,CAAA,GAQI,EARJ,GAAA,qBAAA;QASbC,uBATa,GAAA,YAAA,CASbA,uBATa;QAUbC,YAVa,GAAA,YAAA,CAUbA,YAVa;QAWbC,WAXa,GAAA,YAAA,CAWbA,WAXa;QAYbC,UAZa,GAAA,YAAA,CAYbA,UAZa;QAabC,YAba,GAAA,YAAA,CAabA,YAba;QAcbC,iBAda,GAAA,YAAA,CAcbA,iBAda;QAebC,mBAfa,GAAA,YAAA,CAebA,mBAfa;QAgBbC,uBAhBa,GAAA,YAAA,CAgBbA,uBAhBa;QAiBbvB,MAjBa,GAAA,YAAA,CAiBbA,MAjBa;MAAA,IAAA,WAAA,GAmBsC,IAAA,CAAKwB,KAnB3C;QAmBTvB,kBAnBS,GAAA,WAAA,CAmBTA,kBAnBS;QAmBWC,SAnBX,GAAA,WAAA,CAmBWA,SAnBX;QAmBsBC,WAnBtB,GAAA,WAAA,CAmBsBA,WAnBtB;MAoBjB,IAAMsB,kBAAkB,GAAG,IAAIC,IAAJ,CAASd,UAAT,CAAA,CAAqBe,OAArB,CAAA,CAA3B;MACA,IAAMC,aAAa,GAAGjB,UAAU,IAAIhB,gBAApC;MACA,IAAMkC,OAAO,GAAG7B,MAAM,KAAKpB,IAAXoB,IAAmBK,WAAW,CAACyB,QAA/C;MACA,IAAMC,SAAS,GAAG1B,WAAW,CAAC2B,UAA9B;MACA,IAAMC,aAAa,GAAG,CAACF,SAAS,IAAIF,OAAd,KAA0B,CAAChB,SAAjD;MAEA,OACI,KAAA,CAAA,aAAA,CAAA,KAAA,EAAA;QAAK,SAAS,EAAC;MAAf,CAAA,EACI,KAAA,CAAA,aAAA,CAAC,KAAD,EAAA;QACI,SAAS,EAAElC,UAAU,CAAC,mBAAD,EAAsB;UACvC,gBAAA,EAAkBkC,SAAS,IAAIC;QADQ,CAAtB;MADzB,CAAA,EAKI,KAAA,CAAA,aAAA,CAAC,KAAD,CAAO,MAAP,EAAA,IAAA,EACI,KAAA,CAAA,aAAA,CAAC,MAAD,EAAA;QAAQ,YAAY,EAAEM,YAAtB;QAAoC,IAAI,EAAEQ;MAA1C,CAAA,CADJ,CALJ,EAQI,KAAA,CAAA,aAAA,CAAC,KAAD,CAAO,IAAP,EAAA,IAAA,EACKK,aAAa,IACV,KAAA,CAAA,aAAA,CAAC,eAAD,EAAA;QACI,UAAU,EAAC,WADf;QAEI,SAAS,EAAC,qCAFd;QAGI,WAAW,EAAE,CAAC;UAAEC,EAAE,EAAE,cAAN;UAAsBC,UAAU,EAAE;QAAlC,CAAD,CAHjB;QAII,gBAAgB,EAAC;MAJrB,CAAA,EAMI,KAAA,CAAA,aAAA,CAAC,KAAD,CAAO,IAAP,EAAA;QACI,UAAU,EAAElC,kBADhB;QAEI,aAAA,EAAY,sBAFhB;QAGI,SAAS,EAAE;UACP,sBAAA,EAAwBb,gBAAgB,CAACgD;QADlC;MAHf,CAAA,EAOKP,OAAO,IACJ,KAAA,CAAA,aAAA,CAAC,QAAD,EAAA;QACI,mBAAA,EAAmBzC,gBAAgB,CAACiD,oBADxC;QAEI,aAAA,EAAY,cAFhB;QAGI,OAAO,EAAE,IAAA,CAAKC;MAHlB,CAAA,EAKI,KAAA,CAAA,aAAA,CAAC,QAAD,EAAA,IAAA,CALJ,EAMI,KAAA,CAAA,aAAA,CAAC,gBAAD,EAAsB1C,QAAQ,CAAC2C,mBAA/B,CANJ,CARR,EAiBKR,SAAS,IACN,KAAA,CAAA,aAAA,CAAC,QAAD,EAAA;QACI,mBAAA,EAAmB3C,gBAAgB,CAACoD,sBADxC;QAEI,aAAA,EAAY,gBAFhB;QAGI,OAAO,EAAE,IAAA,CAAKC;MAHlB,CAAA,EAKI,KAAA,CAAA,aAAA,CAAC,OAAD,EAAA,IAAA,CALJ,EAMI,KAAA,CAAA,aAAA,CAAC,gBAAD,EAAsB7C,QAAQ,CAAC8C,qBAA/B,CANJ,CAlBR,CANJ,EAkCKzC,kBAAkB,IACf,KAAA,CAAA,aAAA,CAAC,kBAAD,EAAA;QACI,sBAAA,EAAsBb,gBAAgB,CAACgD,eAD3C;QAEI,MAAM,EAAEnC,kBAFZ;QAGI,OAAO,EAAEL,QAAQ,CAAC+C,mBAHtB;QAII,cAAc,EAAE,IAAA,CAAKC,kBAJzB;QAKI,eAAe,EAAE,IAAA,CAAKC;MAL1B,CAAA,CAnCR,CAFR,EA+CI,KAAA,CAAA,aAAA,CAAA,KAAA,EAAA;QAAK,SAAS,EAAC;MAAf,CAAA,EACI,KAAA,CAAA,aAAA,CAAC,QAAD,EAAA;QACI,mBAAA,EAAmBzD,gBAAgB,CAAC0D,OADxC;QAEI,EAAE,EAAElB,aAAa,CAACxB,EAFtB;QAGI,IAAI,EAAEwB,aAAa,CAACmB,IAHxB;QAII,iBAAiB,EAAE1B;MAJvB,CAAA,CADJ,CA/CJ,EAuDI,KAAA,CAAA,aAAA,CAAA,KAAA,EAAA,IAAA,EACI,KAAA,CAAA,aAAA,CAAC,iBAAD,EAAA;QAAmB,IAAI,EAAEI;MAAzB,CAAA,CADJ,CAvDJ,EA0DKvB,SAAS,GACN,KAAA,CAAA,aAAA,CAAC,WAAD,EAAA;QACI,UAAU,EAAEiB,UADhB;QAEI,SAAS,EAAExC,UAAU,CAAC,oBAAD,EAAuB;UACxC,iBAAA,EAAmBwC;QADqB,CAAvB,CAFzB;QAKI,aAAa,EAAE,IAAA,CAAK6B,YALxB;QAMI,MAAM,EAAE7C,WANZ,CAOI;QAAA;;QACA,IAAI,EAAEe,WARV;QASI,QAAQ,EAAE,IAAA,CAAK+B,wBATnB;QAUI,OAAO,EAAE,IAAA,CAAKC,uBAVlB;QAWI,SAAS,EAAEhD,SAXf;QAYI,QAAQ,EAAEE,EAZd;QAaI,cAAc,EAAEW,cAbpB;QAcI,YAAY,EAAEK,YAdlB;QAeI,uBAAuB,EAAEG,uBAf7B;QAgBI,mBAAmB,EAAED;MAhBzB,CAAA,CADM,GAoBN,KAAA,CAAA,aAAA,CAAC,eAAD,EAAA,QAAA,CAAA;QACI,EAAE,EAAElB,EADR;QAEI,cAAc,EAAEW,cAFpB;QAGI,uBAAuB,EAAEC;MAH7B,CAAA,EAIQC,YAJR,EAAA;QAKI,iBAAiB,EAAEH,KAAK,GAAG,IAAH,GAAU,IALtC;QAMI,iBAAiB,EAAEO;MANvB,CAAA,CAAA,CA9ER,CARJ,CADJ,EAmGKP,KAAK,GAAG,KAAA,CAAA,aAAA,CAAC,aAAD,EAAmBA,KAAnB,CAAH,GAAkC,IAnG5C,CADJ;IAuGH;;;EA1KiBpC,KAAK,CAACoB,S;gBAAtBD,O,kBACoB;EAClBE,QAAQ,EAAEnB,IADQ;EAElBoB,MAAM,EAAEpB;AAFU,C;AA4K1B,eAAeiB,OAAf","sourcesContent":["// @flow\nimport * as React from 'react';\nimport classNames from 'classnames';\nimport noop from 'lodash/noop';\nimport { FormattedMessage } from 'react-intl';\nimport TetherComponent from 'react-tether';\nimport Trash16 from '../../../../icon/line/Trash16';\nimport Pencil16 from '../../../../icon/line/Pencil16';\nimport Avatar from '../Avatar';\nimport Media from '../../../../components/media';\nimport { MenuItem } from '../../../../components/menu';\nimport { ACTIVITY_TARGETS } from '../../../common/interactionTargets';\nimport DeleteConfirmation from '../common/delete-confirmation';\nimport ActivityTimestamp from '../common/activity-timestamp';\nimport UserLink from '../common/user-link';\nimport ActivityError from '../common/activity-error';\nimport ActivityMessage from '../common/activity-message';\nimport CommentForm from '../comment-form';\nimport { PLACEHOLDER_USER } from '../../../../constants';\nimport messages from './messages';\nimport type { GetAvatarUrlCallback, GetProfileUrlCallback } from '../../../common/flowTypes';\nimport type { Translations } from '../../flowTypes';\nimport type { SelectorItems, User } from '../../../../common/types/core';\nimport type { BoxCommentPermission, ActionItemError } from '../../../../common/types/feed';\nimport './Comment.scss';\n\ntype Props = {\n    created_at: string | number,\n    created_by: User,\n    currentUser?: User,\n    error?: ActionItemError,\n    getAvatarUrl: GetAvatarUrlCallback,\n    getMentionWithQuery?: Function,\n    getUserProfileUrl?: GetProfileUrlCallback,\n    id: string,\n    isDisabled?: boolean,\n    isPending?: boolean,\n    mentionSelectorContacts?: SelectorItems<>,\n    modified_at?: string | number,\n    onDelete: ({ id: string, permissions?: BoxCommentPermission }) => any,\n    onEdit: (id: string, text: string, hasMention: boolean, permissions?: BoxCommentPermission) => any,\n    permissions?: BoxCommentPermission,\n    tagged_message: string,\n    translatedTaggedMessage?: string,\n    translations?: Translations,\n};\n\ntype State = {\n    isConfirmingDelete: boolean,\n    isEditing: boolean,\n    isInputOpen: boolean,\n};\n\nclass Comment extends React.Component<Props, State> {\n    static defaultProps = {\n        onDelete: noop,\n        onEdit: noop,\n    };\n\n    state = {\n        isConfirmingDelete: false,\n        isEditing: false,\n        isInputOpen: false,\n    };\n\n    handleDeleteConfirm = (): void => {\n        const { id, onDelete, permissions } = this.props;\n        onDelete({ id, permissions });\n    };\n\n    handleDeleteCancel = (): void => {\n        this.setState({ isConfirmingDelete: false });\n    };\n\n    handleDeleteClick = () => {\n        this.setState({ isConfirmingDelete: true });\n    };\n\n    handleEditClick = (): void => {\n        this.setState({ isEditing: true, isInputOpen: true });\n    };\n\n    commentFormFocusHandler = (): void => this.setState({ isInputOpen: true });\n\n    commentFormCancelHandler = (): void => this.setState({ isInputOpen: false, isEditing: false });\n\n    commentFormSubmitHandler = (): void => this.setState({ isInputOpen: false, isEditing: false });\n\n    handleUpdate = ({ id, text, hasMention }: { hasMention: boolean, id: string, text: string }): void => {\n        const { onEdit, permissions } = this.props;\n        onEdit(id, text, hasMention, permissions);\n        this.commentFormSubmitHandler();\n    };\n\n    render(): React.Node {\n        const {\n            created_by,\n            created_at,\n            permissions = {},\n            id,\n            isPending,\n            error,\n            tagged_message = '',\n            translatedTaggedMessage,\n            translations,\n            currentUser,\n            isDisabled,\n            getAvatarUrl,\n            getUserProfileUrl,\n            getMentionWithQuery,\n            mentionSelectorContacts,\n            onEdit,\n        } = this.props;\n        const { isConfirmingDelete, isEditing, isInputOpen } = this.state;\n        const createdAtTimestamp = new Date(created_at).getTime();\n        const createdByUser = created_by || PLACEHOLDER_USER;\n        const canEdit = onEdit !== noop && permissions.can_edit;\n        const canDelete = permissions.can_delete;\n        const isMenuVisible = (canDelete || canEdit) && !isPending;\n\n        return (\n            <div className=\"bcs-Comment\">\n                <Media\n                    className={classNames('bcs-Comment-media', {\n                        'bcs-is-pending': isPending || error,\n                    })}\n                >\n                    <Media.Figure>\n                        <Avatar getAvatarUrl={getAvatarUrl} user={createdByUser} />\n                    </Media.Figure>\n                    <Media.Body>\n                        {isMenuVisible && (\n                            <TetherComponent\n                                attachment=\"top right\"\n                                className=\"bcs-Comment-deleteConfirmationModal\"\n                                constraints={[{ to: 'scrollParent', attachment: 'together' }]}\n                                targetAttachment=\"bottom right\"\n                            >\n                                <Media.Menu\n                                    isDisabled={isConfirmingDelete}\n                                    data-testid=\"comment-actions-menu\"\n                                    menuProps={{\n                                        'data-resin-component': ACTIVITY_TARGETS.COMMENT_OPTIONS,\n                                    }}\n                                >\n                                    {canEdit && (\n                                        <MenuItem\n                                            data-resin-target={ACTIVITY_TARGETS.COMMENT_OPTIONS_EDIT}\n                                            data-testid=\"edit-comment\"\n                                            onClick={this.handleEditClick}\n                                        >\n                                            <Pencil16 />\n                                            <FormattedMessage {...messages.commentEditMenuItem} />\n                                        </MenuItem>\n                                    )}\n                                    {canDelete && (\n                                        <MenuItem\n                                            data-resin-target={ACTIVITY_TARGETS.COMMENT_OPTIONS_DELETE}\n                                            data-testid=\"delete-comment\"\n                                            onClick={this.handleDeleteClick}\n                                        >\n                                            <Trash16 />\n                                            <FormattedMessage {...messages.commentDeleteMenuItem} />\n                                        </MenuItem>\n                                    )}\n                                </Media.Menu>\n                                {isConfirmingDelete && (\n                                    <DeleteConfirmation\n                                        data-resin-component={ACTIVITY_TARGETS.COMMENT_OPTIONS}\n                                        isOpen={isConfirmingDelete}\n                                        message={messages.commentDeletePrompt}\n                                        onDeleteCancel={this.handleDeleteCancel}\n                                        onDeleteConfirm={this.handleDeleteConfirm}\n                                    />\n                                )}\n                            </TetherComponent>\n                        )}\n                        <div className=\"bcs-Comment-headline\">\n                            <UserLink\n                                data-resin-target={ACTIVITY_TARGETS.PROFILE}\n                                id={createdByUser.id}\n                                name={createdByUser.name}\n                                getUserProfileUrl={getUserProfileUrl}\n                            />\n                        </div>\n                        <div>\n                            <ActivityTimestamp date={createdAtTimestamp} />\n                        </div>\n                        {isEditing ? (\n                            <CommentForm\n                                isDisabled={isDisabled}\n                                className={classNames('bcs-Comment-editor', {\n                                    'bcs-is-disabled': isDisabled,\n                                })}\n                                updateComment={this.handleUpdate}\n                                isOpen={isInputOpen}\n                                // $FlowFixMe\n                                user={currentUser}\n                                onCancel={this.commentFormCancelHandler}\n                                onFocus={this.commentFormFocusHandler}\n                                isEditing={isEditing}\n                                entityId={id}\n                                tagged_message={tagged_message}\n                                getAvatarUrl={getAvatarUrl}\n                                mentionSelectorContacts={mentionSelectorContacts}\n                                getMentionWithQuery={getMentionWithQuery}\n                            />\n                        ) : (\n                            <ActivityMessage\n                                id={id}\n                                tagged_message={tagged_message}\n                                translatedTaggedMessage={translatedTaggedMessage}\n                                {...translations}\n                                translationFailed={error ? true : null}\n                                getUserProfileUrl={getUserProfileUrl}\n                            />\n                        )}\n                    </Media.Body>\n                </Media>\n                {/* $FlowFixMe */}\n                {error ? <ActivityError {...error} /> : null}\n            </div>\n        );\n    }\n}\n\nexport default Comment;\n"]},"metadata":{},"sourceType":"module"}